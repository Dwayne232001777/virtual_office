{"version":3,"sources":["../../../../../packages/react-virtualizer/src/hooks/useVirtualizerMeasure.ts"],"sourcesContent":["import * as React from 'react';\nimport { VirtualizerMeasureProps } from './hooks.types';\nimport { useResizeObserverRef_unstable } from './useResizeObserverRef';\nimport { useFluent_unstable as useFluent } from '@fluentui/react-shared-contexts';\n\n/**\n * React hook that measures virtualized space based on a static size to ensure optimized virtualization length.\n */\nexport const useStaticVirtualizerMeasure = <TElement extends HTMLElement>(\n  virtualizerProps: VirtualizerMeasureProps\n): {\n  virtualizerLength: number;\n  bufferItems: number;\n  bufferSize: number;\n  scrollRef: (instance: TElement | null) => void;\n  containerSizeRef: React.MutableRefObject<number>;\n} => {\n  const {\n    defaultItemSize,\n    direction = 'vertical',\n    bufferItems,\n    bufferSize,\n  } = virtualizerProps;\n\n  const [state, setState] = React.useState({\n    virtualizerLength: 0,\n    _bufferSize: 0,\n    _bufferItems: 0,\n  });\n\n  const containerSizeRef = React.useRef<number>(0);\n  const { targetDocument } = useFluent();\n\n  const { virtualizerLength, _bufferItems, _bufferSize } = state;\n\n  const resizeCallback = React.useCallback(\n    (\n      _entries: ResizeObserverEntry[],\n      // TODO: exclude types from this lint rule: https://github.com/microsoft/fluentui/issues/31286\n      // eslint-disable-next-line no-restricted-globals\n      _observer: ResizeObserver,\n      scrollRef?: React.MutableRefObject<HTMLElement | null>\n    ) => {\n      if (!scrollRef?.current) {\n        return;\n      }\n\n      if (scrollRef.current !== targetDocument?.body) {\n        // We have a local scroll container\n        containerSizeRef.current =\n          direction === 'vertical'\n            ? scrollRef?.current.getBoundingClientRect().height\n            : scrollRef?.current.getBoundingClientRect().width;\n      } else if (targetDocument?.defaultView) {\n        // If our scroll ref is the document body, we should check window height\n        containerSizeRef.current =\n          direction === 'vertical'\n            ? targetDocument?.defaultView?.innerHeight\n            : targetDocument?.defaultView?.innerWidth;\n      }\n      /*\n       * Number of items required to cover viewport.\n       */\n      const length = Math.ceil(containerSizeRef.current / defaultItemSize + 1);\n\n      /*\n       * Number of items to append at each end, i.e. 'preload' each side before entering view.\n       * Minimum: 1\n       */\n      const newBufferItems = bufferItems ?? Math.max(Math.ceil(length / 4), 1);\n\n      /*\n       * This is how far we deviate into the bufferItems to detect a redraw.\n       */\n      const newBufferSize = bufferSize ?? Math.max(defaultItemSize / 2.0, 1);\n\n      const totalLength = length + newBufferItems * 2;\n\n      setState({\n        virtualizerLength: totalLength,\n        _bufferItems: newBufferItems,\n        _bufferSize: newBufferSize,\n      });\n    },\n    [\n      bufferItems,\n      bufferSize,\n      defaultItemSize,\n      direction,\n      targetDocument?.body,\n      targetDocument?.defaultView,\n    ]\n  );\n\n  const scrollRef = useResizeObserverRef_unstable(resizeCallback);\n\n  return {\n    virtualizerLength,\n    bufferItems: _bufferItems,\n    bufferSize: _bufferSize,\n    scrollRef,\n    containerSizeRef,\n  };\n};\n"],"names":["useStaticVirtualizerMeasure","virtualizerProps","defaultItemSize","direction","bufferItems","bufferSize","state","setState","React","useState","virtualizerLength","_bufferSize","_bufferItems","containerSizeRef","useRef","targetDocument","useFluent","resizeCallback","useCallback","_entries","_observer","scrollRef","current","body","getBoundingClientRect","height","width","defaultView","innerHeight","innerWidth","length","Math","ceil","newBufferItems","max","newBufferSize","totalLength","useResizeObserverRef_unstable"],"mappings":";;;;+BAQaA;;;eAAAA;;;;iEARU;sCAEuB;qCACE;AAKzC,MAAMA,8BAA8B,CACzCC;IAQA,MAAM,EACJC,eAAe,EACfC,YAAY,UAAU,EACtBC,WAAW,EACXC,UAAU,EACX,GAAGJ;IAEJ,MAAM,CAACK,OAAOC,SAAS,GAAGC,OAAMC,QAAQ,CAAC;QACvCC,mBAAmB;QACnBC,aAAa;QACbC,cAAc;IAChB;IAEA,MAAMC,mBAAmBL,OAAMM,MAAM,CAAS;IAC9C,MAAM,EAAEC,cAAc,EAAE,GAAGC,IAAAA,uCAAS;IAEpC,MAAM,EAAEN,iBAAiB,EAAEE,YAAY,EAAED,WAAW,EAAE,GAAGL;IAEzD,MAAMW,iBAAiBT,OAAMU,WAAW,CACtC,CACEC,UACA,8FAA8F;IAC9F,iDAAiD;IACjDC,WACAC;QAEA,IAAI,EAACA,6BAAAA,UAAWC,OAAO,GAAE;YACvB;QACF;QAEA,IAAID,UAAUC,OAAO,MAAKP,kCAAAA,eAAgBQ,IAAI,GAAE;YAC9C,mCAAmC;YACnCV,iBAAiBS,OAAO,GACtBnB,cAAc,aACVkB,6BAAAA,UAAWC,OAAO,CAACE,qBAAqB,GAAGC,MAAM,GACjDJ,6BAAAA,UAAWC,OAAO,CAACE,qBAAqB,GAAGE,KAAK;QACxD,OAAO,IAAIX,kCAAAA,eAAgBY,WAAW,EAAE;gBAIhCZ,6BACAA;YAJN,wEAAwE;YACxEF,iBAAiBS,OAAO,GACtBnB,cAAc,aACVY,mCAAAA,8BAAAA,eAAgBY,WAAW,qBAA3BZ,4BAA6Ba,WAAW,GACxCb,mCAAAA,+BAAAA,eAAgBY,WAAW,qBAA3BZ,6BAA6Bc,UAAU;QAC/C;QACA;;OAEC,GACD,MAAMC,SAASC,KAAKC,IAAI,CAACnB,iBAAiBS,OAAO,GAAGpB,kBAAkB;QAEtE;;;OAGC,GACD,MAAM+B,iBAAiB7B,sBAAAA,cAAe2B,KAAKG,GAAG,CAACH,KAAKC,IAAI,CAACF,SAAS,IAAI;QAEtE;;OAEC,GACD,MAAMK,gBAAgB9B,qBAAAA,aAAc0B,KAAKG,GAAG,CAAChC,kBAAkB,KAAK;QAEpE,MAAMkC,cAAcN,SAASG,iBAAiB;QAE9C1B,SAAS;YACPG,mBAAmB0B;YACnBxB,cAAcqB;YACdtB,aAAawB;QACf;IACF,GACA;QACE/B;QACAC;QACAH;QACAC;QACAY,kCAAAA,eAAgBQ,IAAI;QACpBR,kCAAAA,eAAgBY,WAAW;KAC5B;IAGH,MAAMN,YAAYgB,IAAAA,mDAA6B,EAACpB;IAEhD,OAAO;QACLP;QACAN,aAAaQ;QACbP,YAAYM;QACZU;QACAR;IACF;AACF"}