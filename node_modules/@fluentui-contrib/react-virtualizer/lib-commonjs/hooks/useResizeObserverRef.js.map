{"version":3,"sources":["../../../../../packages/react-virtualizer/src/hooks/useResizeObserverRef.ts"],"sourcesContent":["import * as React from 'react';\nimport { useFluent_unstable as useFluent } from '@fluentui/react-shared-contexts';\nimport { debounce } from '../utilities/debounce';\nimport { createResizeObserverFromDocument } from '../utilities/createResizeObserverFromDocument';\nimport { ResizeCallbackWithRef } from './hooks.types';\n\n/**\n * useResizeObserverRef_unstable simplifies resize observer connection and ensures debounce/cleanup\n */\nexport const useResizeObserverRef_unstable = (\n  resizeCallback: ResizeCallbackWithRef\n): React.RefCallback<HTMLElement | HTMLDivElement | null> => {\n  'use no memo';\n\n  const { targetDocument } = useFluent();\n\n  const container = React.useRef<HTMLElement | null>(null);\n  const containerHeightRef = React.useRef<number>(0);\n  const containerWidthRef = React.useRef<number>(0);\n  // the handler for resize observer\n  // TODO: exclude types from this lint rule: https://github.com/microsoft/fluentui/issues/31286\n  const handleResize = debounce(\n    // eslint-disable-next-line no-restricted-globals\n    (entries: ResizeObserverEntry[], observer: ResizeObserver) => {\n      const containerHeight = container.current?.clientHeight;\n      const containerWidth = container.current?.clientWidth;\n      // Our resize observer will fire on scroll resize, let index change handle that instead.\n      if (\n        containerHeightRef.current !== containerHeight ||\n        containerWidth !== containerWidthRef.current\n      ) {\n        containerWidthRef.current = containerWidth ?? 0;\n        containerHeightRef.current = containerHeight ?? 0;\n        resizeCallback(entries, observer, container);\n      }\n    }\n  );\n\n  // Keep the reference of ResizeObserver in the state, as it should live through renders\n  const [resizeObserver, setResizeObserver] = React.useState(() =>\n    createResizeObserverFromDocument(targetDocument, handleResize)\n  );\n\n  React.useEffect(() => {\n    // Update our state when resizeCallback changes\n    container.current = null;\n    resizeObserver?.disconnect();\n    setResizeObserver(() =>\n      createResizeObserverFromDocument(targetDocument, handleResize)\n    );\n  }, [resizeCallback, targetDocument]);\n\n  React.useEffect(() => {\n    return () => {\n      container.current = null;\n      resizeObserver?.disconnect();\n    };\n  }, []);\n\n  const scrollRef = React.useCallback(\n    (instance: HTMLElement | HTMLDivElement | null) => {\n      if (container.current !== instance) {\n        if (container.current) {\n          resizeObserver?.unobserve(container.current);\n        }\n\n        container.current = instance;\n        if (container.current) {\n          resizeObserver?.observe(container.current);\n        }\n      }\n    },\n    [resizeObserver]\n  );\n\n  return scrollRef;\n};\n"],"names":["useResizeObserverRef_unstable","resizeCallback","targetDocument","useFluent","container","React","useRef","containerHeightRef","containerWidthRef","handleResize","debounce","entries","observer","containerHeight","current","clientHeight","containerWidth","clientWidth","resizeObserver","setResizeObserver","useState","createResizeObserverFromDocument","useEffect","disconnect","scrollRef","useCallback","instance","unobserve","observe"],"mappings":";;;;+BASaA;;;eAAAA;;;;iEATU;qCACyB;0BACvB;kDACwB;AAM1C,MAAMA,gCAAgC,CAC3CC;IAEA;IAEA,MAAM,EAAEC,cAAc,EAAE,GAAGC,IAAAA,uCAAS;IAEpC,MAAMC,YAAYC,OAAMC,MAAM,CAAqB;IACnD,MAAMC,qBAAqBF,OAAMC,MAAM,CAAS;IAChD,MAAME,oBAAoBH,OAAMC,MAAM,CAAS;IAC/C,kCAAkC;IAClC,8FAA8F;IAC9F,MAAMG,eAAeC,IAAAA,kBAAQ,EAC3B,iDAAiD;IACjD,CAACC,SAAgCC;YACPR,oBACDA;QADvB,MAAMS,mBAAkBT,qBAAAA,UAAUU,OAAO,qBAAjBV,mBAAmBW,YAAY;QACvD,MAAMC,kBAAiBZ,sBAAAA,UAAUU,OAAO,qBAAjBV,oBAAmBa,WAAW;QACrD,wFAAwF;QACxF,IACEV,mBAAmBO,OAAO,KAAKD,mBAC/BG,mBAAmBR,kBAAkBM,OAAO,EAC5C;YACAN,kBAAkBM,OAAO,GAAGE,yBAAAA,iBAAkB;YAC9CT,mBAAmBO,OAAO,GAAGD,0BAAAA,kBAAmB;YAChDZ,eAAeU,SAASC,UAAUR;QACpC;IACF;IAGF,uFAAuF;IACvF,MAAM,CAACc,gBAAgBC,kBAAkB,GAAGd,OAAMe,QAAQ,CAAC,IACzDC,IAAAA,kEAAgC,EAACnB,gBAAgBO;IAGnDJ,OAAMiB,SAAS,CAAC;QACd,+CAA+C;QAC/ClB,UAAUU,OAAO,GAAG;QACpBI,kCAAAA,eAAgBK,UAAU;QAC1BJ,kBAAkB,IAChBE,IAAAA,kEAAgC,EAACnB,gBAAgBO;IAErD,GAAG;QAACR;QAAgBC;KAAe;IAEnCG,OAAMiB,SAAS,CAAC;QACd,OAAO;YACLlB,UAAUU,OAAO,GAAG;YACpBI,kCAAAA,eAAgBK,UAAU;QAC5B;IACF,GAAG,EAAE;IAEL,MAAMC,YAAYnB,OAAMoB,WAAW,CACjC,CAACC;QACC,IAAItB,UAAUU,OAAO,KAAKY,UAAU;YAClC,IAAItB,UAAUU,OAAO,EAAE;gBACrBI,kCAAAA,eAAgBS,SAAS,CAACvB,UAAUU,OAAO;YAC7C;YAEAV,UAAUU,OAAO,GAAGY;YACpB,IAAItB,UAAUU,OAAO,EAAE;gBACrBI,kCAAAA,eAAgBU,OAAO,CAACxB,UAAUU,OAAO;YAC3C;QACF;IACF,GACA;QAACI;KAAe;IAGlB,OAAOM;AACT"}