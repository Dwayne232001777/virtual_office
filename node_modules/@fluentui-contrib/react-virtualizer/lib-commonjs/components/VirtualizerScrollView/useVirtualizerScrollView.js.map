{"version":3,"sources":["../../../../../../packages/react-virtualizer/src/components/VirtualizerScrollView/useVirtualizerScrollView.ts"],"sourcesContent":["import * as React from 'react';\nimport { slot, useMergedRefs } from '@fluentui/react-utilities';\nimport { useVirtualizer_unstable } from '../Virtualizer/useVirtualizer';\nimport type {\n  VirtualizerScrollViewProps,\n  VirtualizerScrollViewState,\n} from './VirtualizerScrollView.types';\nimport { useStaticVirtualizerMeasure } from '../../Hooks';\nimport { scrollToItemStatic } from '../../Utilities';\nimport type { VirtualizerDataRef } from '../Virtualizer/Virtualizer.types';\nimport { useStaticVirtualizerPagination } from '../../hooks/useStaticPagination';\n\nexport function useVirtualizerScrollView_unstable(\n  props: VirtualizerScrollViewProps\n): VirtualizerScrollViewState {\n  const {\n    imperativeRef,\n    itemSize,\n    numItems,\n    axis = 'vertical',\n    reversed,\n    enablePagination = false,\n    gap,\n  } = props;\n\n  const {\n    virtualizerLength,\n    bufferItems,\n    bufferSize,\n    scrollRef,\n    containerSizeRef,\n  } = useStaticVirtualizerMeasure({\n    defaultItemSize: props.itemSize,\n    direction: props.axis ?? 'vertical',\n  });\n\n  // Store the virtualizer length as a ref for imperative ref access\n  const virtualizerLengthRef = React.useRef<number>(virtualizerLength);\n  if (virtualizerLengthRef.current !== virtualizerLength) {\n    virtualizerLengthRef.current = virtualizerLength;\n  }\n\n  const paginationRef = useStaticVirtualizerPagination(\n    { axis, itemSize },\n    enablePagination\n  );\n  const scrollViewRef = useMergedRefs(\n    props.scrollViewRef,\n    scrollRef,\n    paginationRef\n  ) as React.RefObject<HTMLDivElement>;\n  const imperativeVirtualizerRef = React.useRef<VirtualizerDataRef | null>(\n    null\n  );\n  const scrollCallbackRef = React.useRef<null | ((index: number) => void)>(\n    null\n  );\n\n  React.useImperativeHandle(\n    imperativeRef,\n    () => {\n      return {\n        scrollTo(\n          index: number,\n          behavior = 'auto',\n          callback: ((index: number) => void) | undefined\n        ) {\n          scrollCallbackRef.current = callback ?? null;\n          imperativeVirtualizerRef.current?.setFlaggedIndex(index);\n          scrollToItemStatic({\n            index,\n            itemSize,\n            totalItems: numItems,\n            scrollViewRef,\n            axis,\n            reversed,\n            behavior,\n            gap,\n          });\n        },\n        scrollToPosition(\n          position: number,\n          behavior: ScrollBehavior = 'auto',\n          index?: number, // So we can callback when index rendered\n          callback?: (index: number) => void\n        ) {\n          if (callback) {\n            scrollCallbackRef.current = callback ?? null;\n          }\n\n          if (imperativeVirtualizerRef.current) {\n            if (index !== undefined) {\n              imperativeVirtualizerRef.current.setFlaggedIndex(index);\n            }\n            const positionOptions =\n              axis == 'vertical' ? { top: position } : { left: position };\n            scrollViewRef.current?.scrollTo({\n              behavior,\n              ...positionOptions,\n            });\n          }\n        },\n        currentIndex: imperativeVirtualizerRef.current?.currentIndex,\n        virtualizerLength: virtualizerLengthRef,\n      };\n    },\n    [axis, scrollViewRef, itemSize, numItems, reversed]\n  );\n\n  const handleRenderedIndex = (index: number) => {\n    if (scrollCallbackRef.current) {\n      scrollCallbackRef.current(index);\n    }\n  };\n\n  const virtualizerState = useVirtualizer_unstable({\n    ...props,\n    virtualizerLength,\n    bufferItems,\n    bufferSize,\n    onRenderedFlaggedIndex: handleRenderedIndex,\n    imperativeVirtualizerRef,\n    containerSizeRef,\n    gap,\n  });\n\n  return {\n    ...virtualizerState,\n    components: {\n      ...virtualizerState.components,\n      container: 'div',\n    },\n    container: slot.always(props.container, {\n      defaultProps: {\n        ref: scrollViewRef as React.RefObject<HTMLDivElement>,\n      },\n      elementType: 'div',\n    }),\n  };\n}\n"],"names":["useVirtualizerScrollView_unstable","props","imperativeRef","itemSize","numItems","axis","reversed","enablePagination","gap","virtualizerLength","bufferItems","bufferSize","scrollRef","containerSizeRef","useStaticVirtualizerMeasure","defaultItemSize","direction","virtualizerLengthRef","React","useRef","current","paginationRef","useStaticVirtualizerPagination","scrollViewRef","useMergedRefs","imperativeVirtualizerRef","scrollCallbackRef","useImperativeHandle","scrollTo","index","behavior","callback","setFlaggedIndex","scrollToItemStatic","totalItems","scrollToPosition","position","undefined","positionOptions","top","left","currentIndex","handleRenderedIndex","virtualizerState","useVirtualizer_unstable","onRenderedFlaggedIndex","components","container","slot","always","defaultProps","ref","elementType"],"mappings":";;;;+BAYgBA;;;eAAAA;;;;iEAZO;gCACa;gCACI;uBAKI;2BACT;qCAEY;AAExC,SAASA,kCACdC,KAAiC;IAEjC,MAAM,EACJC,aAAa,EACbC,QAAQ,EACRC,QAAQ,EACRC,OAAO,UAAU,EACjBC,QAAQ,EACRC,mBAAmB,KAAK,EACxBC,GAAG,EACJ,GAAGP;QAUSA;IARb,MAAM,EACJQ,iBAAiB,EACjBC,WAAW,EACXC,UAAU,EACVC,SAAS,EACTC,gBAAgB,EACjB,GAAGC,IAAAA,kCAA2B,EAAC;QAC9BC,iBAAiBd,MAAME,QAAQ;QAC/Ba,WAAWf,CAAAA,cAAAA,MAAMI,IAAI,YAAVJ,cAAc;IAC3B;IAEA,kEAAkE;IAClE,MAAMgB,uBAAuBC,OAAMC,MAAM,CAASV;IAClD,IAAIQ,qBAAqBG,OAAO,KAAKX,mBAAmB;QACtDQ,qBAAqBG,OAAO,GAAGX;IACjC;IAEA,MAAMY,gBAAgBC,IAAAA,mDAA8B,EAClD;QAAEjB;QAAMF;IAAS,GACjBI;IAEF,MAAMgB,gBAAgBC,IAAAA,6BAAa,EACjCvB,MAAMsB,aAAa,EACnBX,WACAS;IAEF,MAAMI,2BAA2BP,OAAMC,MAAM,CAC3C;IAEF,MAAMO,oBAAoBR,OAAMC,MAAM,CACpC;IAGFD,OAAMS,mBAAmB,CACvBzB,eACA;YA0CkBuB;QAzChB,OAAO;YACLG,UACEC,KAAa,EACbC,WAAW,MAAM,EACjBC,QAA+C;oBAG/CN;gBADAC,kBAAkBN,OAAO,GAAGW,mBAAAA,WAAY;iBACxCN,oCAAAA,yBAAyBL,OAAO,qBAAhCK,kCAAkCO,eAAe,CAACH;gBAClDI,IAAAA,6BAAkB,EAAC;oBACjBJ;oBACA1B;oBACA+B,YAAY9B;oBACZmB;oBACAlB;oBACAC;oBACAwB;oBACAtB;gBACF;YACF;YACA2B,kBACEC,QAAgB,EAChBN,WAA2B,MAAM,EACjCD,KAAc,EACdE,QAAkC;gBAElC,IAAIA,UAAU;oBACZL,kBAAkBN,OAAO,GAAGW,mBAAAA,WAAY;gBAC1C;gBAEA,IAAIN,yBAAyBL,OAAO,EAAE;wBAMpCG;oBALA,IAAIM,UAAUQ,WAAW;wBACvBZ,yBAAyBL,OAAO,CAACY,eAAe,CAACH;oBACnD;oBACA,MAAMS,kBACJjC,QAAQ,aAAa;wBAAEkC,KAAKH;oBAAS,IAAI;wBAAEI,MAAMJ;oBAAS;qBAC5Db,yBAAAA,cAAcH,OAAO,qBAArBG,uBAAuBK,QAAQ,CAAC;wBAC9BE;wBACA,GAAGQ,eAAe;oBACpB;gBACF;YACF;YACAG,YAAY,GAAEhB,oCAAAA,yBAAyBL,OAAO,qBAAhCK,kCAAkCgB,YAAY;YAC5DhC,mBAAmBQ;QACrB;IACF,GACA;QAACZ;QAAMkB;QAAepB;QAAUC;QAAUE;KAAS;IAGrD,MAAMoC,sBAAsB,CAACb;QAC3B,IAAIH,kBAAkBN,OAAO,EAAE;YAC7BM,kBAAkBN,OAAO,CAACS;QAC5B;IACF;IAEA,MAAMc,mBAAmBC,IAAAA,uCAAuB,EAAC;QAC/C,GAAG3C,KAAK;QACRQ;QACAC;QACAC;QACAkC,wBAAwBH;QACxBjB;QACAZ;QACAL;IACF;IAEA,OAAO;QACL,GAAGmC,gBAAgB;QACnBG,YAAY;YACV,GAAGH,iBAAiBG,UAAU;YAC9BC,WAAW;QACb;QACAA,WAAWC,oBAAI,CAACC,MAAM,CAAChD,MAAM8C,SAAS,EAAE;YACtCG,cAAc;gBACZC,KAAK5B;YACP;YACA6B,aAAa;QACf;IACF;AACF"}