{"version":3,"sources":["../../../../../../packages/react-virtualizer/src/components/VirtualizerScrollView/useVirtualizerScrollView.ts"],"sourcesContent":["import * as React from 'react';\nimport { slot, useMergedRefs } from '@fluentui/react-utilities';\nimport { useVirtualizer_unstable } from '../Virtualizer/useVirtualizer';\nimport type {\n  VirtualizerScrollViewProps,\n  VirtualizerScrollViewState,\n} from './VirtualizerScrollView.types';\nimport { useStaticVirtualizerMeasure } from '../../Hooks';\nimport { scrollToItemStatic } from '../../Utilities';\nimport type { VirtualizerDataRef } from '../Virtualizer/Virtualizer.types';\nimport { useStaticVirtualizerPagination } from '../../hooks/useStaticPagination';\n\nexport function useVirtualizerScrollView_unstable(\n  props: VirtualizerScrollViewProps\n): VirtualizerScrollViewState {\n  const {\n    imperativeRef,\n    itemSize,\n    numItems,\n    axis = 'vertical',\n    reversed,\n    enablePagination = false,\n    gap,\n  } = props;\n\n  const {\n    virtualizerLength,\n    bufferItems,\n    bufferSize,\n    scrollRef,\n    containerSizeRef,\n  } = useStaticVirtualizerMeasure({\n    defaultItemSize: props.itemSize,\n    direction: props.axis ?? 'vertical',\n  });\n\n  // Store the virtualizer length as a ref for imperative ref access\n  const virtualizerLengthRef = React.useRef<number>(virtualizerLength);\n  if (virtualizerLengthRef.current !== virtualizerLength) {\n    virtualizerLengthRef.current = virtualizerLength;\n  }\n\n  const paginationRef = useStaticVirtualizerPagination(\n    { axis, itemSize },\n    enablePagination\n  );\n  const scrollViewRef = useMergedRefs(\n    props.scrollViewRef,\n    scrollRef,\n    paginationRef\n  ) as React.RefObject<HTMLDivElement>;\n  const imperativeVirtualizerRef = React.useRef<VirtualizerDataRef | null>(\n    null\n  );\n  const scrollCallbackRef = React.useRef<null | ((index: number) => void)>(\n    null\n  );\n\n  React.useImperativeHandle(\n    imperativeRef,\n    () => {\n      return {\n        scrollTo(\n          index: number,\n          behavior = 'auto',\n          callback: ((index: number) => void) | undefined\n        ) {\n          scrollCallbackRef.current = callback ?? null;\n          imperativeVirtualizerRef.current?.setFlaggedIndex(index);\n          scrollToItemStatic({\n            index,\n            itemSize,\n            totalItems: numItems,\n            scrollViewRef,\n            axis,\n            reversed,\n            behavior,\n            gap,\n          });\n        },\n        scrollToPosition(\n          position: number,\n          behavior: ScrollBehavior = 'auto',\n          index?: number, // So we can callback when index rendered\n          callback?: (index: number) => void\n        ) {\n          if (callback) {\n            scrollCallbackRef.current = callback ?? null;\n          }\n\n          if (imperativeVirtualizerRef.current) {\n            if (index !== undefined) {\n              imperativeVirtualizerRef.current.setFlaggedIndex(index);\n            }\n            const positionOptions =\n              axis == 'vertical' ? { top: position } : { left: position };\n            scrollViewRef.current?.scrollTo({\n              behavior,\n              ...positionOptions,\n            });\n          }\n        },\n        currentIndex: imperativeVirtualizerRef.current?.currentIndex,\n        virtualizerLength: virtualizerLengthRef,\n      };\n    },\n    [axis, scrollViewRef, itemSize, numItems, reversed]\n  );\n\n  const handleRenderedIndex = (index: number) => {\n    if (scrollCallbackRef.current) {\n      scrollCallbackRef.current(index);\n    }\n  };\n\n  const virtualizerState = useVirtualizer_unstable({\n    ...props,\n    virtualizerLength,\n    bufferItems,\n    bufferSize,\n    onRenderedFlaggedIndex: handleRenderedIndex,\n    imperativeVirtualizerRef,\n    containerSizeRef,\n    gap,\n  });\n\n  return {\n    ...virtualizerState,\n    components: {\n      ...virtualizerState.components,\n      container: 'div',\n    },\n    container: slot.always(props.container, {\n      defaultProps: {\n        ref: scrollViewRef as React.RefObject<HTMLDivElement>,\n      },\n      elementType: 'div',\n    }),\n  };\n}\n"],"names":["React","slot","useMergedRefs","useVirtualizer_unstable","useStaticVirtualizerMeasure","scrollToItemStatic","useStaticVirtualizerPagination","useVirtualizerScrollView_unstable","props","imperativeRef","itemSize","numItems","axis","reversed","enablePagination","gap","virtualizerLength","bufferItems","bufferSize","scrollRef","containerSizeRef","defaultItemSize","direction","virtualizerLengthRef","useRef","current","paginationRef","scrollViewRef","imperativeVirtualizerRef","scrollCallbackRef","useImperativeHandle","scrollTo","index","behavior","callback","setFlaggedIndex","totalItems","scrollToPosition","position","undefined","positionOptions","top","left","currentIndex","handleRenderedIndex","virtualizerState","onRenderedFlaggedIndex","components","container","always","defaultProps","ref","elementType"],"mappings":"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"}