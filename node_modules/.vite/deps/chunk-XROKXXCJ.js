import {
  _GetClassNameOf,
  init_utils
} from "./chunk-JZELQRBK.js";
import {
  FlowGraphBinaryOperationBlock,
  init_flowGraphBinaryOperationBlock
} from "./chunk-C2UBFGLR.js";
import {
  FlowGraphUnaryOperationBlock,
  init_flowGraphUnaryOperationBlock
} from "./chunk-RC5KAGLV.js";
import {
  FlowGraphBlock,
  RichTypeAny,
  RichTypeBoolean,
  RichTypeMatrix,
  RichTypeNumber,
  RichTypeQuaternion,
  RichTypeVector2,
  RichTypeVector3,
  getRichTypeByFlowGraphType,
  init_flowGraphBlock,
  init_flowGraphRichTypes
} from "./chunk-WADD4RBF.js";
import {
  Vector3Dot,
  Vector4Dot,
  init_math_vector_functions
} from "./chunk-KSPXS46C.js";
import {
  Quaternion,
  Vector3,
  Vector4,
  init_math_vector
} from "./chunk-VQZCJUUR.js";
import {
  RegisterClass,
  init_typeStore
} from "./chunk-7ANHXSNA.js";
import {
  Clamp,
  init_math_scalar_functions
} from "./chunk-XBFJXXXT.js";
import {
  __esm
} from "./chunk-V4OQ3NZ2.js";

// node_modules/@babylonjs/core/FlowGraph/flowGraphMath.js
function GetAngleBetweenQuaternions(q1, q2) {
  return Math.acos(Clamp(Vector4Dot(q1, q2), -1, 1)) * 2;
}
function GetQuaternionFromDirections(a, b) {
  const result = new Quaternion();
  GetQuaternionFromDirectionsToRef(a, b, result);
  return result;
}
function GetQuaternionFromDirectionsToRef(a, b, result) {
  const axis = Vector3.Cross(a, b);
  const angle = Math.acos(Clamp(Vector3Dot(a, b), -1, 1));
  Quaternion.RotationAxisToRef(axis, angle, result);
  return result;
}
var init_flowGraphMath = __esm({
  "node_modules/@babylonjs/core/FlowGraph/flowGraphMath.js"() {
    init_math_scalar_functions();
    init_math_vector();
    init_math_vector_functions();
  }
});

// node_modules/@babylonjs/core/FlowGraph/Blocks/Data/Math/flowGraphVectorMathBlocks.js
function TransformVector(a, b) {
  const className = _GetClassNameOf(a);
  switch (className) {
    case "Vector2":
      return b.transformVector(a);
    case "Vector3":
      return b.transformVector(a);
    case "Vector4":
      a = a;
      return new Vector4(a.x * b.m[0] + a.y * b.m[1] + a.z * b.m[2] + a.w * b.m[3], a.x * b.m[4] + a.y * b.m[5] + a.z * b.m[6] + a.w * b.m[7], a.x * b.m[8] + a.y * b.m[9] + a.z * b.m[10] + a.w * b.m[11], a.x * b.m[12] + a.y * b.m[13] + a.z * b.m[14] + a.w * b.m[15]);
    default:
      throw new Error(`Cannot transform value ${a}`);
  }
}
var AxisCacheName, AngleCacheName, CacheExecIdName, FlowGraphLengthBlock, FlowGraphNormalizeBlock, FlowGraphDotBlock, FlowGraphCrossBlock, FlowGraphRotate2DBlock, FlowGraphRotate3DBlock, FlowGraphTransformBlock, FlowGraphTransformCoordinatesBlock, FlowGraphConjugateBlock, FlowGraphAngleBetweenBlock, FlowGraphQuaternionFromAxisAngleBlock, FlowGraphAxisAngleFromQuaternionBlock, FlowGraphQuaternionFromDirectionsBlock;
var init_flowGraphVectorMathBlocks = __esm({
  "node_modules/@babylonjs/core/FlowGraph/Blocks/Data/Math/flowGraphVectorMathBlocks.js"() {
    init_flowGraphBlock();
    init_flowGraphRichTypes();
    init_typeStore();
    init_flowGraphBinaryOperationBlock();
    init_flowGraphUnaryOperationBlock();
    init_math_vector();
    init_utils();
    init_flowGraphMath();
    AxisCacheName = "cachedOperationAxis";
    AngleCacheName = "cachedOperationAngle";
    CacheExecIdName = "cachedExecutionId";
    FlowGraphLengthBlock = class extends FlowGraphUnaryOperationBlock {
      constructor(config) {
        super(RichTypeAny, RichTypeNumber, (a) => this._polymorphicLength(a), "FlowGraphLengthBlock", config);
      }
      _polymorphicLength(a) {
        const aClassName = _GetClassNameOf(a);
        switch (aClassName) {
          case "Vector2":
          case "Vector3":
          case "Vector4":
          case "Quaternion":
            return a.length();
          default:
            throw new Error(`Cannot compute length of value ${a}`);
        }
      }
    };
    RegisterClass("FlowGraphLengthBlock", FlowGraphLengthBlock);
    FlowGraphNormalizeBlock = class extends FlowGraphUnaryOperationBlock {
      constructor(config) {
        super(RichTypeAny, RichTypeAny, (a) => this._polymorphicNormalize(a), "FlowGraphNormalizeBlock", config);
      }
      _polymorphicNormalize(a) {
        const aClassName = _GetClassNameOf(a);
        let normalized;
        switch (aClassName) {
          case "Vector2":
          case "Vector3":
          case "Vector4":
          case "Quaternion":
            normalized = a.normalizeToNew();
            if (this.config?.nanOnZeroLength) {
              const length = a.length();
              if (length === 0) {
                normalized.setAll(NaN);
              }
            }
            return normalized;
          default:
            throw new Error(`Cannot normalize value ${a}`);
        }
      }
    };
    RegisterClass("FlowGraphNormalizeBlock", FlowGraphNormalizeBlock);
    FlowGraphDotBlock = class extends FlowGraphBinaryOperationBlock {
      constructor(config) {
        super(RichTypeAny, RichTypeAny, RichTypeNumber, (a, b) => this._polymorphicDot(a, b), "FlowGraphDotBlock", config);
      }
      _polymorphicDot(a, b) {
        const className = _GetClassNameOf(a);
        switch (className) {
          case "Vector2":
          case "Vector3":
          case "Vector4":
          case "Quaternion":
            return a.dot(b);
          default:
            throw new Error(`Cannot get dot product of ${a} and ${b}`);
        }
      }
    };
    RegisterClass("FlowGraphDotBlock", FlowGraphDotBlock);
    FlowGraphCrossBlock = class extends FlowGraphBinaryOperationBlock {
      constructor(config) {
        super(RichTypeVector3, RichTypeVector3, RichTypeVector3, (a, b) => Vector3.Cross(a, b), "FlowGraphCrossBlock", config);
      }
    };
    RegisterClass("FlowGraphCrossBlock", FlowGraphCrossBlock);
    FlowGraphRotate2DBlock = class extends FlowGraphBinaryOperationBlock {
      constructor(config) {
        super(RichTypeVector2, RichTypeNumber, RichTypeVector2, (a, b) => a.rotate(b), "FlowGraphRotate2DBlock", config);
      }
    };
    RegisterClass("FlowGraphRotate2DBlock", FlowGraphRotate2DBlock);
    FlowGraphRotate3DBlock = class extends FlowGraphBinaryOperationBlock {
      constructor(config) {
        super(RichTypeVector3, RichTypeQuaternion, RichTypeVector3, (a, b) => a.applyRotationQuaternion(b), "FlowGraphRotate3DBlock", config);
      }
    };
    RegisterClass("FlowGraphRotate3DBlock", FlowGraphRotate3DBlock);
    FlowGraphTransformBlock = class extends FlowGraphBinaryOperationBlock {
      constructor(config) {
        const vectorType = config?.vectorType || "Vector3";
        const matrixType = vectorType === "Vector2" ? "Matrix2D" : vectorType === "Vector3" ? "Matrix3D" : "Matrix";
        super(getRichTypeByFlowGraphType(vectorType), getRichTypeByFlowGraphType(matrixType), getRichTypeByFlowGraphType(vectorType), TransformVector, "FlowGraphTransformVectorBlock", config);
      }
    };
    RegisterClass("FlowGraphTransformVectorBlock", FlowGraphTransformBlock);
    FlowGraphTransformCoordinatesBlock = class extends FlowGraphBinaryOperationBlock {
      constructor(config) {
        super(RichTypeVector3, RichTypeMatrix, RichTypeVector3, (a, b) => Vector3.TransformCoordinates(a, b), "FlowGraphTransformCoordinatesBlock", config);
      }
    };
    RegisterClass("FlowGraphTransformCoordinatesBlock", FlowGraphTransformCoordinatesBlock);
    FlowGraphConjugateBlock = class extends FlowGraphUnaryOperationBlock {
      constructor(config) {
        super(RichTypeQuaternion, RichTypeQuaternion, (a) => a.conjugate(), "FlowGraphConjugateBlock", config);
      }
    };
    RegisterClass("FlowGraphConjugateBlock", FlowGraphConjugateBlock);
    FlowGraphAngleBetweenBlock = class extends FlowGraphBinaryOperationBlock {
      constructor(config) {
        super(RichTypeQuaternion, RichTypeQuaternion, RichTypeNumber, (a, b) => GetAngleBetweenQuaternions(a, b), "FlowGraphAngleBetweenBlock", config);
      }
    };
    RegisterClass("FlowGraphAngleBetweenBlock", FlowGraphAngleBetweenBlock);
    FlowGraphQuaternionFromAxisAngleBlock = class extends FlowGraphBinaryOperationBlock {
      constructor(config) {
        super(RichTypeVector3, RichTypeNumber, RichTypeQuaternion, (a, b) => Quaternion.RotationAxis(a, b), "FlowGraphQuaternionFromAxisAngleBlock", config);
      }
    };
    RegisterClass("FlowGraphQuaternionFromAxisAngleBlock", FlowGraphQuaternionFromAxisAngleBlock);
    FlowGraphAxisAngleFromQuaternionBlock = class extends FlowGraphBlock {
      constructor(config) {
        super(config);
        this.a = this.registerDataInput("a", RichTypeQuaternion);
        this.axis = this.registerDataOutput("axis", RichTypeVector3);
        this.angle = this.registerDataOutput("angle", RichTypeNumber);
        this.isValid = this.registerDataOutput("isValid", RichTypeBoolean);
      }
      /** @override */
      _updateOutputs(context) {
        const cachedExecutionId = context._getExecutionVariable(this, CacheExecIdName, -1);
        const cachedAxis = context._getExecutionVariable(this, AxisCacheName, null);
        const cachedAngle = context._getExecutionVariable(this, AngleCacheName, null);
        if (cachedAxis !== void 0 && cachedAxis !== null && cachedAngle !== void 0 && cachedAngle !== null && cachedExecutionId === context.executionId) {
          this.axis.setValue(cachedAxis, context);
          this.angle.setValue(cachedAngle, context);
        } else {
          try {
            const { axis, angle } = this.a.getValue(context).toAxisAngle();
            context._setExecutionVariable(this, AxisCacheName, axis);
            context._setExecutionVariable(this, AngleCacheName, angle);
            context._setExecutionVariable(this, CacheExecIdName, context.executionId);
            this.axis.setValue(axis, context);
            this.angle.setValue(angle, context);
            this.isValid.setValue(true, context);
          } catch (e) {
            this.isValid.setValue(false, context);
          }
        }
      }
      /** @override */
      getClassName() {
        return "FlowGraphAxisAngleFromQuaternionBlock";
      }
    };
    RegisterClass("FlowGraphAxisAngleFromQuaternionBlock", FlowGraphAxisAngleFromQuaternionBlock);
    FlowGraphQuaternionFromDirectionsBlock = class extends FlowGraphBinaryOperationBlock {
      constructor(config) {
        super(RichTypeVector3, RichTypeVector3, RichTypeQuaternion, (a, b) => GetQuaternionFromDirections(a, b), "FlowGraphQuaternionFromDirectionsBlock", config);
      }
    };
  }
});

export {
  FlowGraphLengthBlock,
  FlowGraphNormalizeBlock,
  FlowGraphDotBlock,
  FlowGraphCrossBlock,
  FlowGraphRotate2DBlock,
  FlowGraphRotate3DBlock,
  FlowGraphTransformBlock,
  FlowGraphTransformCoordinatesBlock,
  FlowGraphConjugateBlock,
  FlowGraphAngleBetweenBlock,
  FlowGraphQuaternionFromAxisAngleBlock,
  FlowGraphAxisAngleFromQuaternionBlock,
  FlowGraphQuaternionFromDirectionsBlock,
  init_flowGraphVectorMathBlocks
};
//# sourceMappingURL=chunk-XROKXXCJ.js.map
