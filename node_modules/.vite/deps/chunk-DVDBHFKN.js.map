{
  "version": 3,
  "sources": ["../../../dev/core/src/Misc/reflector.ts"],
  "sourcesContent": ["import type { Scene } from \"../scene\";\r\nimport { Logger } from \"./logger\";\r\nimport { SceneSerializer } from \"./sceneSerializer\";\r\n\r\n/**\r\n * Class used to connect with the reflector zone of the sandbox via the reflector bridge\r\n * @since 5.0.0\r\n */\r\nexport class Reflector {\r\n    private static readonly _SERVER_PREFIX = \"$$\";\r\n\r\n    private _scene: Scene;\r\n    private _webSocket: WebSocket;\r\n\r\n    /**\r\n     * Constructs a reflector object.\r\n     * @param scene The scene to use\r\n     * @param hostname The hostname of the reflector bridge\r\n     * @param port The port of the reflector bridge\r\n     */\r\n    public constructor(scene: Scene, hostname: string, port: number) {\r\n        this._scene = scene;\r\n\r\n        Logger.Log(`[Reflector] Connecting to ws://${hostname}:${port}`);\r\n        this._webSocket = new WebSocket(`ws://${hostname}:${port}`);\r\n\r\n        this._webSocket.onmessage = (event) => {\r\n            const message: string = event.data;\r\n            if (message.startsWith(Reflector._SERVER_PREFIX)) {\r\n                const serverMessage = message.substring(Reflector._SERVER_PREFIX.length);\r\n                Logger.Log(`[Reflector] Received server message: ${serverMessage.substring(0, 64)}`);\r\n                this._handleServerMessage(serverMessage);\r\n                return;\r\n            } else {\r\n                Logger.Log(`[Reflector] Received client message: ${message.substring(0, 64)}`);\r\n                this._handleClientMessage();\r\n            }\r\n        };\r\n\r\n        this._webSocket.onclose = (event) => {\r\n            Logger.Log(`[Reflector] Disconnected ${event.code} ${event.reason}`);\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Closes the reflector connection\r\n     */\r\n    public close(): void {\r\n        this._webSocket.close();\r\n    }\r\n\r\n    private _handleServerMessage(message: string): void {\r\n        switch (message) {\r\n            case \"connected\": {\r\n                // eslint-disable-next-line @typescript-eslint/no-floating-promises, github/no-then\r\n                SceneSerializer.SerializeAsync(this._scene).then((serialized) => {\r\n                    this._webSocket.send(`load|${JSON.stringify(serialized)}`);\r\n                });\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    private _handleClientMessage(): void {\r\n        // do nothing\r\n    }\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;AACA,IAOa;AAPb;;;AACA;AAMM,IAAO,YAAP,MAAO,WAAS;;;;;;;MAYlB,YAAmB,OAAc,UAAkB,MAAY;AAC3D,aAAK,SAAS;AAEd,eAAO,IAAI,kCAAkC,QAAQ,IAAI,IAAI,EAAE;AAC/D,aAAK,aAAa,IAAI,UAAU,QAAQ,QAAQ,IAAI,IAAI,EAAE;AAE1D,aAAK,WAAW,YAAY,CAAC,UAAS;AAClC,gBAAM,UAAkB,MAAM;AAC9B,cAAI,QAAQ,WAAW,WAAU,cAAc,GAAG;AAC9C,kBAAM,gBAAgB,QAAQ,UAAU,WAAU,eAAe,MAAM;AACvE,mBAAO,IAAI,wCAAwC,cAAc,UAAU,GAAG,EAAE,CAAC,EAAE;AACnF,iBAAK,qBAAqB,aAAa;AACvC;UACJ,OAAO;AACH,mBAAO,IAAI,wCAAwC,QAAQ,UAAU,GAAG,EAAE,CAAC,EAAE;AAC7E,iBAAK,qBAAoB;UAC7B;QACJ;AAEA,aAAK,WAAW,UAAU,CAAC,UAAS;AAChC,iBAAO,IAAI,4BAA4B,MAAM,IAAI,IAAI,MAAM,MAAM,EAAE;QACvE;MACJ;;;;MAKO,QAAK;AACR,aAAK,WAAW,MAAK;MACzB;MAEQ,qBAAqB,SAAe;AACxC,gBAAQ,SAAS;UACb,KAAK,aAAa;AAEd,4BAAgB,eAAe,KAAK,MAAM,EAAE,KAAK,CAAC,eAAc;AAC5D,mBAAK,WAAW,KAAK,QAAQ,KAAK,UAAU,UAAU,CAAC,EAAE;YAC7D,CAAC;AACD;UACJ;QACJ;MACJ;MAEQ,uBAAoB;MAE5B;;AAxDwB,cAAA,iBAAiB;;;",
  "names": []
}
