{
  "version": 3,
  "sources": ["../../../dev/core/src/Meshes/buffer.ts", "../../../dev/core/src/Engines/AbstractEngine/abstractEngine.query.ts", "../../../dev/core/src/Engines/WebGPU/webgpuTextureHelper.ts", "../../../dev/core/src/Engines/thinWebGPUEngine.ts", "../../../dev/core/src/Engines/WebGPU/webgpuBundleList.ts", "../../../dev/core/src/Engines/WebGPU/Extensions/engine.query.ts"],
  "sourcesContent": ["/**\r\n * This is here for backwards compatibility with 4.2\r\n * @internal\r\n */\r\nexport { VertexBuffer, Buffer } from \"../Buffers/buffer\";\r\n", "import { AbstractMesh } from \"core/Meshes/abstractMesh\";\r\nimport type { Nullable } from \"../../types\";\r\nimport { AbstractEngine } from \"../abstractEngine\";\r\n\r\n/** @internal */\r\nexport type OcclusionQuery = WebGLQuery | number;\r\n\r\n/** @internal */\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nexport class _OcclusionDataStorage {\r\n    /** @internal */\r\n    public occlusionInternalRetryCounter = 0;\r\n\r\n    /** @internal */\r\n    public isOcclusionQueryInProgress = false;\r\n\r\n    /** @internal */\r\n    public isOccluded = false;\r\n\r\n    /** @internal */\r\n    public occlusionRetryCount = -1;\r\n\r\n    /** @internal */\r\n    public occlusionType = AbstractMesh.OCCLUSION_TYPE_NONE;\r\n\r\n    /** @internal */\r\n    public occlusionQueryAlgorithmType = AbstractMesh.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE;\r\n\r\n    /** @internal */\r\n    public forceRenderingWhenOccluded = false;\r\n}\r\n\r\ndeclare module \"../../Engines/abstractEngine\" {\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    export interface AbstractEngine {\r\n        /**\r\n         * Create a new webGL query (you must be sure that queries are supported by checking getCaps() function)\r\n         * @returns the new query\r\n         */\r\n        createQuery(): Nullable<OcclusionQuery>;\r\n        /**\r\n         * Delete and release a webGL query\r\n         * @param query defines the query to delete\r\n         * @returns the current engine\r\n         */\r\n        deleteQuery(query: OcclusionQuery): AbstractEngine /**\r\n         * Check if a given query has resolved and got its value\r\n         * @param query defines the query to check\r\n         * @returns true if the query got its value\r\n         */;\r\n        isQueryResultAvailable(query: OcclusionQuery): boolean;\r\n        /**\r\n         * Gets the value of a given query\r\n         * @param query defines the query to check\r\n         * @returns the value of the query\r\n         */\r\n        getQueryResult(query: OcclusionQuery): number;\r\n        /**\r\n         * Initiates an occlusion query\r\n         * @param algorithmType defines the algorithm to use\r\n         * @param query defines the query to use\r\n         * @returns the current engine\r\n         * @see https://doc.babylonjs.com/features/featuresDeepDive/occlusionQueries\r\n         */\r\n        beginOcclusionQuery(algorithmType: number, query: OcclusionQuery): boolean;\r\n        /**\r\n         * Ends an occlusion query\r\n         * @see https://doc.babylonjs.com/features/featuresDeepDive/occlusionQueries\r\n         * @param algorithmType defines the algorithm to use\r\n         * @returns the current engine\r\n         */\r\n        endOcclusionQuery(algorithmType: number): AbstractEngine;\r\n    }\r\n}\r\n\r\nAbstractEngine.prototype.createQuery = function (): Nullable<OcclusionQuery> {\r\n    return null;\r\n};\r\n\r\nAbstractEngine.prototype.deleteQuery = function (query: OcclusionQuery): AbstractEngine {\r\n    // Do nothing. Must be implemented by child classes\r\n    return this;\r\n};\r\n\r\nAbstractEngine.prototype.isQueryResultAvailable = function (query: OcclusionQuery): boolean {\r\n    // Do nothing. Must be implemented by child classes\r\n    return false;\r\n};\r\n\r\nAbstractEngine.prototype.getQueryResult = function (query: OcclusionQuery): number {\r\n    // Do nothing. Must be implemented by child classes\r\n    return 0;\r\n};\r\n\r\nAbstractEngine.prototype.beginOcclusionQuery = function (algorithmType: number, query: OcclusionQuery): boolean {\r\n    // Do nothing. Must be implemented by child classes\r\n    return false;\r\n};\r\n\r\nAbstractEngine.prototype.endOcclusionQuery = function (algorithmType: number): AbstractEngine {\r\n    // Do nothing. Must be implemented by child classes\r\n    return this;\r\n};\r\n\r\ndeclare module \"../../Meshes/abstractMesh\" {\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    export interface AbstractMesh {\r\n        /**\r\n         * Backing filed\r\n         * @internal\r\n         */\r\n        // eslint-disable-next-line @typescript-eslint/naming-convention\r\n        __occlusionDataStorage: _OcclusionDataStorage;\r\n\r\n        /**\r\n         * Access property\r\n         * @internal\r\n         */\r\n        _occlusionDataStorage: _OcclusionDataStorage;\r\n\r\n        /**\r\n         * This number indicates the number of allowed retries before stop the occlusion query, this is useful if the occlusion query is taking long time before to the query result is retrieved, the query result indicates if the object is visible within the scene or not and based on that Babylon.Js engine decides to show or hide the object.\r\n         * The default value is -1 which means don't break the query and wait till the result\r\n         * @see https://doc.babylonjs.com/features/featuresDeepDive/occlusionQueries\r\n         */\r\n        occlusionRetryCount: number;\r\n\r\n        /**\r\n         * This property is responsible for starting the occlusion query within the Mesh or not, this property is also used to determine what should happen when the occlusionRetryCount is reached. It has supports 3 values:\r\n         * * OCCLUSION_TYPE_NONE (Default Value): this option means no occlusion query within the Mesh.\r\n         * * OCCLUSION_TYPE_OPTIMISTIC: this option is means use occlusion query and if occlusionRetryCount is reached and the query is broken show the mesh.\r\n         * * OCCLUSION_TYPE_STRICT: this option is means use occlusion query and if occlusionRetryCount is reached and the query is broken restore the last state of the mesh occlusion if the mesh was visible then show the mesh if was hidden then hide don't show.\r\n         * @see https://doc.babylonjs.com/features/featuresDeepDive/occlusionQueries\r\n         */\r\n        occlusionType: number;\r\n\r\n        /**\r\n         * This property determines the type of occlusion query algorithm to run in WebGl, you can use:\r\n         * * AbstractMesh.OCCLUSION_ALGORITHM_TYPE_ACCURATE which is mapped to GL_ANY_SAMPLES_PASSED.\r\n         * * AbstractMesh.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE (Default Value) which is mapped to GL_ANY_SAMPLES_PASSED_CONSERVATIVE which is a false positive algorithm that is faster than GL_ANY_SAMPLES_PASSED but less accurate.\r\n         * @see https://doc.babylonjs.com/features/featuresDeepDive/occlusionQueries\r\n         */\r\n        occlusionQueryAlgorithmType: number;\r\n\r\n        /**\r\n         * Gets or sets whether the mesh is occluded or not, it is used also to set the initial state of the mesh to be occluded or not\r\n         * @see https://doc.babylonjs.com/features/featuresDeepDive/occlusionQueries\r\n         */\r\n        isOccluded: boolean;\r\n\r\n        /**\r\n         * Flag to check the progress status of the query\r\n         * @see https://doc.babylonjs.com/features/featuresDeepDive/occlusionQueries\r\n         */\r\n        isOcclusionQueryInProgress: boolean;\r\n\r\n        /**\r\n         * Flag to force rendering the mesh even if occluded\r\n         * @see https://doc.babylonjs.com/features/featuresDeepDive/occlusionQueries\r\n         */\r\n        forceRenderingWhenOccluded: boolean;\r\n    }\r\n}\r\nObject.defineProperty(AbstractMesh.prototype, \"isOcclusionQueryInProgress\", {\r\n    get: function (this: AbstractMesh) {\r\n        return this._occlusionDataStorage.isOcclusionQueryInProgress;\r\n    },\r\n    set: function (this: AbstractMesh, value: boolean) {\r\n        this._occlusionDataStorage.isOcclusionQueryInProgress = value;\r\n    },\r\n    enumerable: false,\r\n    configurable: true,\r\n});\r\n\r\nObject.defineProperty(AbstractMesh.prototype, \"_occlusionDataStorage\", {\r\n    get: function (this: AbstractMesh) {\r\n        if (!this.__occlusionDataStorage) {\r\n            this.__occlusionDataStorage = new _OcclusionDataStorage();\r\n        }\r\n        return this.__occlusionDataStorage;\r\n    },\r\n    enumerable: false,\r\n    configurable: true,\r\n});\r\n\r\nObject.defineProperty(AbstractMesh.prototype, \"isOccluded\", {\r\n    get: function (this: AbstractMesh) {\r\n        return this._occlusionDataStorage.isOccluded;\r\n    },\r\n    set: function (this: AbstractMesh, value: boolean) {\r\n        this._occlusionDataStorage.isOccluded = value;\r\n    },\r\n    enumerable: true,\r\n    configurable: true,\r\n});\r\n\r\nObject.defineProperty(AbstractMesh.prototype, \"occlusionQueryAlgorithmType\", {\r\n    get: function (this: AbstractMesh) {\r\n        return this._occlusionDataStorage.occlusionQueryAlgorithmType;\r\n    },\r\n    set: function (this: AbstractMesh, value: number) {\r\n        this._occlusionDataStorage.occlusionQueryAlgorithmType = value;\r\n    },\r\n    enumerable: true,\r\n    configurable: true,\r\n});\r\n\r\nObject.defineProperty(AbstractMesh.prototype, \"occlusionType\", {\r\n    get: function (this: AbstractMesh) {\r\n        return this._occlusionDataStorage.occlusionType;\r\n    },\r\n    set: function (this: AbstractMesh, value: number) {\r\n        this._occlusionDataStorage.occlusionType = value;\r\n    },\r\n    enumerable: true,\r\n    configurable: true,\r\n});\r\n\r\nObject.defineProperty(AbstractMesh.prototype, \"occlusionRetryCount\", {\r\n    get: function (this: AbstractMesh) {\r\n        return this._occlusionDataStorage.occlusionRetryCount;\r\n    },\r\n    set: function (this: AbstractMesh, value: number) {\r\n        this._occlusionDataStorage.occlusionRetryCount = value;\r\n    },\r\n    enumerable: true,\r\n    configurable: true,\r\n});\r\n\r\nObject.defineProperty(AbstractMesh.prototype, \"forceRenderingWhenOccluded\", {\r\n    get: function (this: AbstractMesh) {\r\n        return this._occlusionDataStorage.forceRenderingWhenOccluded;\r\n    },\r\n    set: function (this: AbstractMesh, value: boolean) {\r\n        this._occlusionDataStorage.forceRenderingWhenOccluded = value;\r\n    },\r\n    enumerable: true,\r\n    configurable: true,\r\n});\r\n\r\n// We also need to update AbstractMesh as there is a portion of the code there\r\nAbstractMesh.prototype._checkOcclusionQuery = function () {\r\n    const dataStorage = this._occlusionDataStorage;\r\n\r\n    if (dataStorage.occlusionType === AbstractMesh.OCCLUSION_TYPE_NONE) {\r\n        dataStorage.isOccluded = false;\r\n        return false;\r\n    }\r\n\r\n    const engine = this.getEngine();\r\n\r\n    if (!engine.getCaps().supportOcclusionQuery) {\r\n        dataStorage.isOccluded = false;\r\n        return false;\r\n    }\r\n\r\n    if (!engine.isQueryResultAvailable) {\r\n        // Occlusion query where not referenced\r\n        dataStorage.isOccluded = false;\r\n        return false;\r\n    }\r\n\r\n    if (this.isOcclusionQueryInProgress && this._occlusionQuery !== null && this._occlusionQuery !== undefined) {\r\n        const isOcclusionQueryAvailable = engine.isQueryResultAvailable(this._occlusionQuery);\r\n        if (isOcclusionQueryAvailable) {\r\n            const occlusionQueryResult = engine.getQueryResult(this._occlusionQuery);\r\n\r\n            dataStorage.isOcclusionQueryInProgress = false;\r\n            dataStorage.occlusionInternalRetryCounter = 0;\r\n            dataStorage.isOccluded = occlusionQueryResult > 0 ? false : true;\r\n        } else {\r\n            dataStorage.occlusionInternalRetryCounter++;\r\n\r\n            if (dataStorage.occlusionRetryCount !== -1 && dataStorage.occlusionInternalRetryCounter > dataStorage.occlusionRetryCount) {\r\n                dataStorage.isOcclusionQueryInProgress = false;\r\n                dataStorage.occlusionInternalRetryCounter = 0;\r\n\r\n                // if optimistic set isOccluded to false regardless of the status of isOccluded. (Render in the current render loop)\r\n                // if strict continue the last state of the object.\r\n                dataStorage.isOccluded = dataStorage.occlusionType === AbstractMesh.OCCLUSION_TYPE_OPTIMISTIC ? false : dataStorage.isOccluded;\r\n            } else {\r\n                return dataStorage.occlusionType === AbstractMesh.OCCLUSION_TYPE_OPTIMISTIC ? false : dataStorage.isOccluded;\r\n            }\r\n        }\r\n    }\r\n\r\n    const scene = this.getScene();\r\n    if (scene.getBoundingBoxRenderer) {\r\n        const occlusionBoundingBoxRenderer = scene.getBoundingBoxRenderer();\r\n\r\n        if (this._occlusionQuery === null) {\r\n            this._occlusionQuery = engine.createQuery();\r\n        }\r\n\r\n        if (this._occlusionQuery && engine.beginOcclusionQuery(dataStorage.occlusionQueryAlgorithmType, this._occlusionQuery)) {\r\n            occlusionBoundingBoxRenderer.renderOcclusionBoundingBox(this);\r\n            engine.endOcclusionQuery(dataStorage.occlusionQueryAlgorithmType);\r\n            this._occlusionDataStorage.isOcclusionQueryInProgress = true;\r\n        }\r\n    }\r\n\r\n    return dataStorage.isOccluded;\r\n};\r\n", "/* eslint-disable babylonjs/available */\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nimport * as WebGPUConstants from \"./webgpuConstants\";\r\nimport { ILog2 } from \"../../Maths/math.scalar.functions\";\r\nimport { Constants } from \"../constants\";\r\nimport type { InternalTexture } from \"../../Materials/Textures/internalTexture\";\r\nimport type { IHardwareTextureWrapper } from \"../../Materials/Textures/hardwareTextureWrapper\";\r\n\r\n/** @internal */\r\nexport class WebGPUTextureHelper {\r\n    public static ComputeNumMipmapLevels(width: number, height: number) {\r\n        return ILog2(Math.max(width, height)) + 1;\r\n    }\r\n\r\n    public static GetTextureTypeFromFormat(format: GPUTextureFormat): number {\r\n        switch (format) {\r\n            // One Component = 8 bits unsigned\r\n            case WebGPUConstants.TextureFormat.R8Unorm:\r\n            case WebGPUConstants.TextureFormat.R8Uint:\r\n            case WebGPUConstants.TextureFormat.RG8Unorm:\r\n            case WebGPUConstants.TextureFormat.RG8Uint:\r\n            case WebGPUConstants.TextureFormat.RGBA8Unorm:\r\n            case WebGPUConstants.TextureFormat.RGBA8UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.RGBA8Uint:\r\n            case WebGPUConstants.TextureFormat.BGRA8Unorm:\r\n            case WebGPUConstants.TextureFormat.BGRA8UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.RGB10A2UINT: // composite format - let's say it's byte...\r\n            case WebGPUConstants.TextureFormat.RGB10A2Unorm: // composite format - let's say it's byte...\r\n            case WebGPUConstants.TextureFormat.RGB9E5UFloat: // composite format - let's say it's byte...\r\n            case WebGPUConstants.TextureFormat.RG11B10UFloat: // composite format - let's say it's byte...\r\n            case WebGPUConstants.TextureFormat.BC7RGBAUnorm:\r\n            case WebGPUConstants.TextureFormat.BC7RGBAUnormSRGB:\r\n            case WebGPUConstants.TextureFormat.BC6HRGBUFloat:\r\n            case WebGPUConstants.TextureFormat.BC5RGUnorm:\r\n            case WebGPUConstants.TextureFormat.BC3RGBAUnorm:\r\n            case WebGPUConstants.TextureFormat.BC3RGBAUnormSRGB:\r\n            case WebGPUConstants.TextureFormat.BC2RGBAUnorm:\r\n            case WebGPUConstants.TextureFormat.BC2RGBAUnormSRGB:\r\n            case WebGPUConstants.TextureFormat.BC4RUnorm:\r\n            case WebGPUConstants.TextureFormat.BC1RGBAUnorm:\r\n            case WebGPUConstants.TextureFormat.BC1RGBAUnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ETC2RGB8Unorm:\r\n            case WebGPUConstants.TextureFormat.ETC2RGB8UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ETC2RGB8A1Unorm:\r\n            case WebGPUConstants.TextureFormat.ETC2RGB8A1UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ETC2RGBA8Unorm:\r\n            case WebGPUConstants.TextureFormat.ETC2RGBA8UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.EACR11Unorm:\r\n            case WebGPUConstants.TextureFormat.EACRG11Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC4x4Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC4x4UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ASTC5x4Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC5x4UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ASTC5x5Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC5x5UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ASTC6x5Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC6x5UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ASTC6x6Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC6x6UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ASTC8x5Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC8x5UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ASTC8x6Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC8x6UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ASTC8x8Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC8x8UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ASTC10x5Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC10x5UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ASTC10x6Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC10x6UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ASTC10x8Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC10x8UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ASTC10x10Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC10x10UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ASTC12x10Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC12x10UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ASTC12x12Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC12x12UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.Stencil8:\r\n                return Constants.TEXTURETYPE_UNSIGNED_BYTE;\r\n\r\n            // One Component = 8 bits signed\r\n            case WebGPUConstants.TextureFormat.R8Snorm:\r\n            case WebGPUConstants.TextureFormat.R8Sint:\r\n            case WebGPUConstants.TextureFormat.RG8Snorm:\r\n            case WebGPUConstants.TextureFormat.RG8Sint:\r\n            case WebGPUConstants.TextureFormat.RGBA8Snorm:\r\n            case WebGPUConstants.TextureFormat.RGBA8Sint:\r\n            case WebGPUConstants.TextureFormat.BC6HRGBFloat:\r\n            case WebGPUConstants.TextureFormat.BC5RGSnorm:\r\n            case WebGPUConstants.TextureFormat.BC4RSnorm:\r\n            case WebGPUConstants.TextureFormat.EACR11Snorm:\r\n            case WebGPUConstants.TextureFormat.EACRG11Snorm:\r\n                return Constants.TEXTURETYPE_BYTE;\r\n\r\n            // One component = 16 bits unsigned\r\n            case WebGPUConstants.TextureFormat.R16Uint:\r\n            case WebGPUConstants.TextureFormat.R16Unorm:\r\n            case WebGPUConstants.TextureFormat.RG16Unorm:\r\n            case WebGPUConstants.TextureFormat.RGBA16Unorm:\r\n            case WebGPUConstants.TextureFormat.RG16Uint:\r\n            case WebGPUConstants.TextureFormat.RGBA16Uint:\r\n            case WebGPUConstants.TextureFormat.Depth16Unorm:\r\n                return Constants.TEXTURETYPE_UNSIGNED_SHORT;\r\n\r\n            // One component = 16 bits signed\r\n            case WebGPUConstants.TextureFormat.R16Sint:\r\n            case WebGPUConstants.TextureFormat.R16Snorm:\r\n            case WebGPUConstants.TextureFormat.RG16Snorm:\r\n            case WebGPUConstants.TextureFormat.RGBA16Snorm:\r\n            case WebGPUConstants.TextureFormat.RG16Sint:\r\n            case WebGPUConstants.TextureFormat.RGBA16Sint:\r\n                return Constants.TEXTURETYPE_SHORT;\r\n\r\n            case WebGPUConstants.TextureFormat.R16Float:\r\n            case WebGPUConstants.TextureFormat.RG16Float:\r\n            case WebGPUConstants.TextureFormat.RGBA16Float:\r\n                return Constants.TEXTURETYPE_HALF_FLOAT;\r\n\r\n            // One component = 32 bits unsigned\r\n            case WebGPUConstants.TextureFormat.R32Uint:\r\n            case WebGPUConstants.TextureFormat.RG32Uint:\r\n            case WebGPUConstants.TextureFormat.RGBA32Uint:\r\n                return Constants.TEXTURETYPE_UNSIGNED_INTEGER;\r\n\r\n            // One component = 32 bits signed\r\n            case WebGPUConstants.TextureFormat.R32Sint:\r\n            case WebGPUConstants.TextureFormat.RG32Sint:\r\n            case WebGPUConstants.TextureFormat.RGBA32Sint:\r\n                return Constants.TEXTURETYPE_UNSIGNED_INTEGER;\r\n\r\n            case WebGPUConstants.TextureFormat.R32Float:\r\n            case WebGPUConstants.TextureFormat.RG32Float:\r\n            case WebGPUConstants.TextureFormat.RGBA32Float:\r\n            case WebGPUConstants.TextureFormat.Depth32Float:\r\n            case WebGPUConstants.TextureFormat.Depth32FloatStencil8:\r\n            case WebGPUConstants.TextureFormat.Depth24Plus:\r\n            case WebGPUConstants.TextureFormat.Depth24PlusStencil8:\r\n                return Constants.TEXTURETYPE_FLOAT;\r\n        }\r\n\r\n        return Constants.TEXTURETYPE_UNSIGNED_BYTE;\r\n    }\r\n\r\n    public static GetBlockInformationFromFormat(format: GPUTextureFormat): { width: number; height: number; length: number } {\r\n        switch (format) {\r\n            // 8 bits formats\r\n            case WebGPUConstants.TextureFormat.R8Unorm:\r\n            case WebGPUConstants.TextureFormat.R8Snorm:\r\n            case WebGPUConstants.TextureFormat.R8Uint:\r\n            case WebGPUConstants.TextureFormat.R8Sint:\r\n                return { width: 1, height: 1, length: 1 };\r\n\r\n            // 16 bits formats\r\n            case WebGPUConstants.TextureFormat.R16Uint:\r\n            case WebGPUConstants.TextureFormat.R16Sint:\r\n            case WebGPUConstants.TextureFormat.R16Unorm:\r\n            case WebGPUConstants.TextureFormat.R16Snorm:\r\n            case WebGPUConstants.TextureFormat.R16Float:\r\n            case WebGPUConstants.TextureFormat.RG8Unorm:\r\n            case WebGPUConstants.TextureFormat.RG8Snorm:\r\n            case WebGPUConstants.TextureFormat.RG8Uint:\r\n            case WebGPUConstants.TextureFormat.RG8Sint:\r\n                return { width: 1, height: 1, length: 2 };\r\n\r\n            // 32 bits formats\r\n            case WebGPUConstants.TextureFormat.R32Uint:\r\n            case WebGPUConstants.TextureFormat.R32Sint:\r\n            case WebGPUConstants.TextureFormat.R32Float:\r\n            case WebGPUConstants.TextureFormat.RG16Uint:\r\n            case WebGPUConstants.TextureFormat.RG16Sint:\r\n            case WebGPUConstants.TextureFormat.RG16Float:\r\n            case WebGPUConstants.TextureFormat.RG16Unorm:\r\n            case WebGPUConstants.TextureFormat.RG16Snorm:\r\n            case WebGPUConstants.TextureFormat.RGBA8Unorm:\r\n            case WebGPUConstants.TextureFormat.RGBA8UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.RGBA8Snorm:\r\n            case WebGPUConstants.TextureFormat.RGBA8Uint:\r\n            case WebGPUConstants.TextureFormat.RGBA8Sint:\r\n            case WebGPUConstants.TextureFormat.BGRA8Unorm:\r\n            case WebGPUConstants.TextureFormat.BGRA8UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.RGB9E5UFloat:\r\n            case WebGPUConstants.TextureFormat.RGB10A2UINT:\r\n            case WebGPUConstants.TextureFormat.RGB10A2Unorm:\r\n            case WebGPUConstants.TextureFormat.RG11B10UFloat:\r\n                return { width: 1, height: 1, length: 4 };\r\n\r\n            // 64 bits formats\r\n            case WebGPUConstants.TextureFormat.RG32Uint:\r\n            case WebGPUConstants.TextureFormat.RG32Sint:\r\n            case WebGPUConstants.TextureFormat.RG32Float:\r\n            case WebGPUConstants.TextureFormat.RGBA16Uint:\r\n            case WebGPUConstants.TextureFormat.RGBA16Sint:\r\n            case WebGPUConstants.TextureFormat.RGBA16Float:\r\n            case WebGPUConstants.TextureFormat.RGBA16Unorm:\r\n            case WebGPUConstants.TextureFormat.RGBA16Snorm:\r\n                return { width: 1, height: 1, length: 8 };\r\n\r\n            // 128 bits formats\r\n            case WebGPUConstants.TextureFormat.RGBA32Uint:\r\n            case WebGPUConstants.TextureFormat.RGBA32Sint:\r\n            case WebGPUConstants.TextureFormat.RGBA32Float:\r\n                return { width: 1, height: 1, length: 16 };\r\n\r\n            // Depth and stencil formats\r\n            case WebGPUConstants.TextureFormat.Stencil8:\r\n                // eslint-disable-next-line no-throw-literal\r\n                throw \"No fixed size for Stencil8 format!\";\r\n            case WebGPUConstants.TextureFormat.Depth16Unorm:\r\n                return { width: 1, height: 1, length: 2 };\r\n            case WebGPUConstants.TextureFormat.Depth24Plus:\r\n                // eslint-disable-next-line no-throw-literal\r\n                throw \"No fixed size for Depth24Plus format!\";\r\n            case WebGPUConstants.TextureFormat.Depth24PlusStencil8:\r\n                // eslint-disable-next-line no-throw-literal\r\n                throw \"No fixed size for Depth24PlusStencil8 format!\";\r\n            case WebGPUConstants.TextureFormat.Depth32Float:\r\n                return { width: 1, height: 1, length: 4 };\r\n            case WebGPUConstants.TextureFormat.Depth32FloatStencil8:\r\n                return { width: 1, height: 1, length: 5 };\r\n\r\n            // BC compressed formats usable if \"texture-compression-bc\" is both\r\n            // supported by the device/user agent and enabled in requestDevice.\r\n            case WebGPUConstants.TextureFormat.BC7RGBAUnorm:\r\n            case WebGPUConstants.TextureFormat.BC7RGBAUnormSRGB:\r\n            case WebGPUConstants.TextureFormat.BC6HRGBUFloat:\r\n            case WebGPUConstants.TextureFormat.BC6HRGBFloat:\r\n            case WebGPUConstants.TextureFormat.BC5RGUnorm:\r\n            case WebGPUConstants.TextureFormat.BC5RGSnorm:\r\n            case WebGPUConstants.TextureFormat.BC3RGBAUnorm:\r\n            case WebGPUConstants.TextureFormat.BC3RGBAUnormSRGB:\r\n            case WebGPUConstants.TextureFormat.BC2RGBAUnorm:\r\n            case WebGPUConstants.TextureFormat.BC2RGBAUnormSRGB:\r\n                return { width: 4, height: 4, length: 16 };\r\n\r\n            case WebGPUConstants.TextureFormat.BC4RUnorm:\r\n            case WebGPUConstants.TextureFormat.BC4RSnorm:\r\n            case WebGPUConstants.TextureFormat.BC1RGBAUnorm:\r\n            case WebGPUConstants.TextureFormat.BC1RGBAUnormSRGB:\r\n                return { width: 4, height: 4, length: 8 };\r\n\r\n            // ETC2 compressed formats usable if \"texture-compression-etc2\" is both\r\n            // supported by the device/user agent and enabled in requestDevice.\r\n            case WebGPUConstants.TextureFormat.ETC2RGB8Unorm:\r\n            case WebGPUConstants.TextureFormat.ETC2RGB8UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ETC2RGB8A1Unorm:\r\n            case WebGPUConstants.TextureFormat.ETC2RGB8A1UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.EACR11Unorm:\r\n            case WebGPUConstants.TextureFormat.EACR11Snorm:\r\n                return { width: 4, height: 4, length: 8 };\r\n\r\n            case WebGPUConstants.TextureFormat.ETC2RGBA8Unorm:\r\n            case WebGPUConstants.TextureFormat.ETC2RGBA8UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.EACRG11Unorm:\r\n            case WebGPUConstants.TextureFormat.EACRG11Snorm:\r\n                return { width: 4, height: 4, length: 16 };\r\n\r\n            // ASTC compressed formats usable if \"texture-compression-astc\" is both\r\n            // supported by the device/user agent and enabled in requestDevice.\r\n            case WebGPUConstants.TextureFormat.ASTC4x4Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC4x4UnormSRGB:\r\n                return { width: 4, height: 4, length: 16 };\r\n            case WebGPUConstants.TextureFormat.ASTC5x4Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC5x4UnormSRGB:\r\n                return { width: 5, height: 4, length: 16 };\r\n            case WebGPUConstants.TextureFormat.ASTC5x5Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC5x5UnormSRGB:\r\n                return { width: 5, height: 5, length: 16 };\r\n            case WebGPUConstants.TextureFormat.ASTC6x5Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC6x5UnormSRGB:\r\n                return { width: 6, height: 5, length: 16 };\r\n            case WebGPUConstants.TextureFormat.ASTC6x6Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC6x6UnormSRGB:\r\n                return { width: 6, height: 6, length: 16 };\r\n            case WebGPUConstants.TextureFormat.ASTC8x5Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC8x5UnormSRGB:\r\n                return { width: 8, height: 5, length: 16 };\r\n            case WebGPUConstants.TextureFormat.ASTC8x6Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC8x6UnormSRGB:\r\n                return { width: 8, height: 6, length: 16 };\r\n            case WebGPUConstants.TextureFormat.ASTC8x8Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC8x8UnormSRGB:\r\n                return { width: 8, height: 8, length: 16 };\r\n            case WebGPUConstants.TextureFormat.ASTC10x5Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC10x5UnormSRGB:\r\n                return { width: 10, height: 5, length: 16 };\r\n            case WebGPUConstants.TextureFormat.ASTC10x6Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC10x6UnormSRGB:\r\n                return { width: 10, height: 6, length: 16 };\r\n            case WebGPUConstants.TextureFormat.ASTC10x8Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC10x8UnormSRGB:\r\n                return { width: 10, height: 8, length: 16 };\r\n            case WebGPUConstants.TextureFormat.ASTC10x10Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC10x10UnormSRGB:\r\n                return { width: 10, height: 10, length: 16 };\r\n            case WebGPUConstants.TextureFormat.ASTC12x10Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC12x10UnormSRGB:\r\n                return { width: 12, height: 10, length: 16 };\r\n            case WebGPUConstants.TextureFormat.ASTC12x12Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC12x12UnormSRGB:\r\n                return { width: 12, height: 12, length: 16 };\r\n        }\r\n\r\n        return { width: 1, height: 1, length: 4 };\r\n    }\r\n\r\n    public static IsHardwareTexture(texture: IHardwareTextureWrapper | GPUTexture): texture is IHardwareTextureWrapper {\r\n        return !!(texture as IHardwareTextureWrapper).release;\r\n    }\r\n\r\n    public static IsInternalTexture(texture: InternalTexture | GPUTexture): texture is InternalTexture {\r\n        return !!(texture as InternalTexture).dispose;\r\n    }\r\n\r\n    public static IsImageBitmap(imageBitmap: ImageBitmap | { width: number; height: number }): imageBitmap is ImageBitmap {\r\n        return (imageBitmap as ImageBitmap).close !== undefined;\r\n    }\r\n\r\n    public static IsImageBitmapArray(imageBitmap: ImageBitmap[] | { width: number; height: number }): imageBitmap is ImageBitmap[] {\r\n        return Array.isArray(imageBitmap as ImageBitmap[]) && (imageBitmap as ImageBitmap[])[0].close !== undefined;\r\n    }\r\n\r\n    public static IsCompressedFormat(format: GPUTextureFormat): boolean {\r\n        switch (format) {\r\n            case WebGPUConstants.TextureFormat.BC7RGBAUnormSRGB:\r\n            case WebGPUConstants.TextureFormat.BC7RGBAUnorm:\r\n            case WebGPUConstants.TextureFormat.BC6HRGBFloat:\r\n            case WebGPUConstants.TextureFormat.BC6HRGBUFloat:\r\n            case WebGPUConstants.TextureFormat.BC5RGSnorm:\r\n            case WebGPUConstants.TextureFormat.BC5RGUnorm:\r\n            case WebGPUConstants.TextureFormat.BC4RSnorm:\r\n            case WebGPUConstants.TextureFormat.BC4RUnorm:\r\n            case WebGPUConstants.TextureFormat.BC3RGBAUnormSRGB:\r\n            case WebGPUConstants.TextureFormat.BC3RGBAUnorm:\r\n            case WebGPUConstants.TextureFormat.BC2RGBAUnormSRGB:\r\n            case WebGPUConstants.TextureFormat.BC2RGBAUnorm:\r\n            case WebGPUConstants.TextureFormat.BC1RGBAUnormSRGB:\r\n            case WebGPUConstants.TextureFormat.BC1RGBAUnorm:\r\n            case WebGPUConstants.TextureFormat.ETC2RGB8Unorm:\r\n            case WebGPUConstants.TextureFormat.ETC2RGB8UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ETC2RGB8A1Unorm:\r\n            case WebGPUConstants.TextureFormat.ETC2RGB8A1UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ETC2RGBA8Unorm:\r\n            case WebGPUConstants.TextureFormat.ETC2RGBA8UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.EACR11Unorm:\r\n            case WebGPUConstants.TextureFormat.EACR11Snorm:\r\n            case WebGPUConstants.TextureFormat.EACRG11Unorm:\r\n            case WebGPUConstants.TextureFormat.EACRG11Snorm:\r\n            case WebGPUConstants.TextureFormat.ASTC4x4Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC4x4UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ASTC5x4Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC5x4UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ASTC5x5Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC5x5UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ASTC6x5Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC6x5UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ASTC6x6Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC6x6UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ASTC8x5Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC8x5UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ASTC8x6Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC8x6UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ASTC8x8Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC8x8UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ASTC10x5Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC10x5UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ASTC10x6Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC10x6UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ASTC10x8Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC10x8UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ASTC10x10Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC10x10UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ASTC12x10Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC12x10UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ASTC12x12Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC12x12UnormSRGB:\r\n                return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    public static GetWebGPUTextureFormat(type: number, format: number, useSRGBBuffer = false): GPUTextureFormat {\r\n        switch (format) {\r\n            case Constants.TEXTUREFORMAT_DEPTH16:\r\n                return WebGPUConstants.TextureFormat.Depth16Unorm;\r\n            case Constants.TEXTUREFORMAT_DEPTH24:\r\n                return WebGPUConstants.TextureFormat.Depth24Plus;\r\n            case Constants.TEXTUREFORMAT_DEPTH24_STENCIL8:\r\n                return WebGPUConstants.TextureFormat.Depth24PlusStencil8;\r\n            case Constants.TEXTUREFORMAT_DEPTH32_FLOAT:\r\n                return WebGPUConstants.TextureFormat.Depth32Float;\r\n            case Constants.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8:\r\n                return WebGPUConstants.TextureFormat.Depth32FloatStencil8;\r\n            case Constants.TEXTUREFORMAT_STENCIL8:\r\n                return WebGPUConstants.TextureFormat.Stencil8;\r\n\r\n            case Constants.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM:\r\n                return useSRGBBuffer ? WebGPUConstants.TextureFormat.BC7RGBAUnormSRGB : WebGPUConstants.TextureFormat.BC7RGBAUnorm;\r\n            case Constants.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT:\r\n                return WebGPUConstants.TextureFormat.BC6HRGBUFloat;\r\n            case Constants.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT:\r\n                return WebGPUConstants.TextureFormat.BC6HRGBFloat;\r\n            case Constants.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5:\r\n                return useSRGBBuffer ? WebGPUConstants.TextureFormat.BC3RGBAUnormSRGB : WebGPUConstants.TextureFormat.BC3RGBAUnorm;\r\n            case Constants.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3:\r\n                return useSRGBBuffer ? WebGPUConstants.TextureFormat.BC2RGBAUnormSRGB : WebGPUConstants.TextureFormat.BC2RGBAUnorm;\r\n            case Constants.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1:\r\n            case Constants.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1:\r\n                return useSRGBBuffer ? WebGPUConstants.TextureFormat.BC1RGBAUnormSRGB : WebGPUConstants.TextureFormat.BC1RGBAUnorm;\r\n            case Constants.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4:\r\n                return useSRGBBuffer ? WebGPUConstants.TextureFormat.ASTC4x4UnormSRGB : WebGPUConstants.TextureFormat.ASTC4x4Unorm;\r\n            case Constants.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL:\r\n            case Constants.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2:\r\n                return useSRGBBuffer ? WebGPUConstants.TextureFormat.ETC2RGB8UnormSRGB : WebGPUConstants.TextureFormat.ETC2RGB8Unorm;\r\n            case Constants.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC:\r\n                return useSRGBBuffer ? WebGPUConstants.TextureFormat.ETC2RGBA8UnormSRGB : WebGPUConstants.TextureFormat.ETC2RGBA8Unorm;\r\n        }\r\n\r\n        switch (type) {\r\n            case Constants.TEXTURETYPE_BYTE:\r\n                switch (format) {\r\n                    case Constants.TEXTUREFORMAT_RED:\r\n                        return WebGPUConstants.TextureFormat.R8Snorm;\r\n                    case Constants.TEXTUREFORMAT_RG:\r\n                        return WebGPUConstants.TextureFormat.RG8Snorm;\r\n                    case Constants.TEXTUREFORMAT_RGB:\r\n                        // eslint-disable-next-line no-throw-literal\r\n                        throw \"RGB format not supported in WebGPU\";\r\n                    case Constants.TEXTUREFORMAT_RED_INTEGER:\r\n                        return WebGPUConstants.TextureFormat.R8Sint;\r\n                    case Constants.TEXTUREFORMAT_RG_INTEGER:\r\n                        return WebGPUConstants.TextureFormat.RG8Sint;\r\n                    case Constants.TEXTUREFORMAT_RGB_INTEGER:\r\n                        // eslint-disable-next-line no-throw-literal\r\n                        throw \"RGB_INTEGER format not supported in WebGPU\";\r\n                    case Constants.TEXTUREFORMAT_RGBA_INTEGER:\r\n                        return WebGPUConstants.TextureFormat.RGBA8Sint;\r\n                    default:\r\n                        return WebGPUConstants.TextureFormat.RGBA8Snorm;\r\n                }\r\n            case Constants.TEXTURETYPE_UNSIGNED_BYTE:\r\n                switch (format) {\r\n                    case Constants.TEXTUREFORMAT_RED:\r\n                        return WebGPUConstants.TextureFormat.R8Unorm;\r\n                    case Constants.TEXTUREFORMAT_RG:\r\n                        return WebGPUConstants.TextureFormat.RG8Unorm;\r\n                    case Constants.TEXTUREFORMAT_RGB:\r\n                        // eslint-disable-next-line no-throw-literal\r\n                        throw \"TEXTUREFORMAT_RGB format not supported in WebGPU\";\r\n                    case Constants.TEXTUREFORMAT_RGBA:\r\n                        return useSRGBBuffer ? WebGPUConstants.TextureFormat.RGBA8UnormSRGB : WebGPUConstants.TextureFormat.RGBA8Unorm;\r\n                    case Constants.TEXTUREFORMAT_BGRA:\r\n                        return useSRGBBuffer ? WebGPUConstants.TextureFormat.BGRA8UnormSRGB : WebGPUConstants.TextureFormat.BGRA8Unorm;\r\n                    case Constants.TEXTUREFORMAT_RED_INTEGER:\r\n                        return WebGPUConstants.TextureFormat.R8Uint;\r\n                    case Constants.TEXTUREFORMAT_RG_INTEGER:\r\n                        return WebGPUConstants.TextureFormat.RG8Uint;\r\n                    case Constants.TEXTUREFORMAT_RGB_INTEGER:\r\n                        // eslint-disable-next-line no-throw-literal\r\n                        throw \"RGB_INTEGER format not supported in WebGPU\";\r\n                    case Constants.TEXTUREFORMAT_RGBA_INTEGER:\r\n                        return WebGPUConstants.TextureFormat.RGBA8Uint;\r\n                    case Constants.TEXTUREFORMAT_ALPHA:\r\n                        // eslint-disable-next-line no-throw-literal\r\n                        throw \"TEXTUREFORMAT_ALPHA format not supported in WebGPU\";\r\n                    case Constants.TEXTUREFORMAT_LUMINANCE:\r\n                        // eslint-disable-next-line no-throw-literal\r\n                        throw \"TEXTUREFORMAT_LUMINANCE format not supported in WebGPU\";\r\n                    case Constants.TEXTUREFORMAT_LUMINANCE_ALPHA:\r\n                        // eslint-disable-next-line no-throw-literal\r\n                        throw \"TEXTUREFORMAT_LUMINANCE_ALPHA format not supported in WebGPU\";\r\n                    default:\r\n                        return WebGPUConstants.TextureFormat.RGBA8Unorm;\r\n                }\r\n            case Constants.TEXTURETYPE_SHORT:\r\n                switch (format) {\r\n                    case Constants.TEXTUREFORMAT_RED_INTEGER:\r\n                        return WebGPUConstants.TextureFormat.R16Sint;\r\n                    case Constants.TEXTUREFORMAT_RG_INTEGER:\r\n                        return WebGPUConstants.TextureFormat.RG16Sint;\r\n                    case Constants.TEXTUREFORMAT_RGB_INTEGER:\r\n                        // eslint-disable-next-line no-throw-literal\r\n                        throw \"TEXTUREFORMAT_RGB_INTEGER format not supported in WebGPU\";\r\n                    case Constants.TEXTUREFORMAT_RGBA_INTEGER:\r\n                        return WebGPUConstants.TextureFormat.RGBA16Sint;\r\n                    default:\r\n                        return WebGPUConstants.TextureFormat.RGBA16Sint;\r\n                }\r\n            case Constants.TEXTURETYPE_UNSIGNED_SHORT:\r\n                switch (format) {\r\n                    case Constants.TEXTUREFORMAT_RED_INTEGER:\r\n                        return WebGPUConstants.TextureFormat.R16Uint;\r\n                    case Constants.TEXTUREFORMAT_RG_INTEGER:\r\n                        return WebGPUConstants.TextureFormat.RG16Uint;\r\n                    case Constants.TEXTUREFORMAT_RGB_INTEGER:\r\n                        // eslint-disable-next-line no-throw-literal\r\n                        throw \"TEXTUREFORMAT_RGB_INTEGER format not supported in WebGPU\";\r\n                    case Constants.TEXTUREFORMAT_RGBA_INTEGER:\r\n                        return WebGPUConstants.TextureFormat.RGBA16Uint;\r\n                    default:\r\n                        return WebGPUConstants.TextureFormat.RGBA16Uint;\r\n                }\r\n            case Constants.TEXTURETYPE_INT:\r\n                switch (format) {\r\n                    case Constants.TEXTUREFORMAT_RED_INTEGER:\r\n                        return WebGPUConstants.TextureFormat.R32Sint;\r\n                    case Constants.TEXTUREFORMAT_RG_INTEGER:\r\n                        return WebGPUConstants.TextureFormat.RG32Sint;\r\n                    case Constants.TEXTUREFORMAT_RGB_INTEGER:\r\n                        // eslint-disable-next-line no-throw-literal\r\n                        throw \"TEXTUREFORMAT_RGB_INTEGER format not supported in WebGPU\";\r\n                    case Constants.TEXTUREFORMAT_RGBA_INTEGER:\r\n                        return WebGPUConstants.TextureFormat.RGBA32Sint;\r\n                    default:\r\n                        return WebGPUConstants.TextureFormat.RGBA32Sint;\r\n                }\r\n            case Constants.TEXTURETYPE_UNSIGNED_INTEGER: // Refers to UNSIGNED_INT\r\n                switch (format) {\r\n                    case Constants.TEXTUREFORMAT_RED_INTEGER:\r\n                        return WebGPUConstants.TextureFormat.R32Uint;\r\n                    case Constants.TEXTUREFORMAT_RG_INTEGER:\r\n                        return WebGPUConstants.TextureFormat.RG32Uint;\r\n                    case Constants.TEXTUREFORMAT_RGB_INTEGER:\r\n                        // eslint-disable-next-line no-throw-literal\r\n                        throw \"TEXTUREFORMAT_RGB_INTEGER format not supported in WebGPU\";\r\n                    case Constants.TEXTUREFORMAT_RGBA_INTEGER:\r\n                        return WebGPUConstants.TextureFormat.RGBA32Uint;\r\n                    default:\r\n                        return WebGPUConstants.TextureFormat.RGBA32Uint;\r\n                }\r\n            case Constants.TEXTURETYPE_FLOAT:\r\n                switch (format) {\r\n                    case Constants.TEXTUREFORMAT_RED:\r\n                        return WebGPUConstants.TextureFormat.R32Float; // By default. Other possibility is R16Float.\r\n                    case Constants.TEXTUREFORMAT_RG:\r\n                        return WebGPUConstants.TextureFormat.RG32Float; // By default. Other possibility is RG16Float.\r\n                    case Constants.TEXTUREFORMAT_RGB:\r\n                        // eslint-disable-next-line no-throw-literal\r\n                        throw \"TEXTUREFORMAT_RGB format not supported in WebGPU\";\r\n                    case Constants.TEXTUREFORMAT_RGBA:\r\n                        return WebGPUConstants.TextureFormat.RGBA32Float; // By default. Other possibility is RGBA16Float.\r\n                    default:\r\n                        return WebGPUConstants.TextureFormat.RGBA32Float;\r\n                }\r\n            case Constants.TEXTURETYPE_HALF_FLOAT:\r\n                switch (format) {\r\n                    case Constants.TEXTUREFORMAT_RED:\r\n                        return WebGPUConstants.TextureFormat.R16Float;\r\n                    case Constants.TEXTUREFORMAT_RG:\r\n                        return WebGPUConstants.TextureFormat.RG16Float;\r\n                    case Constants.TEXTUREFORMAT_RGB:\r\n                        // eslint-disable-next-line no-throw-literal\r\n                        throw \"TEXTUREFORMAT_RGB format not supported in WebGPU\";\r\n                    case Constants.TEXTUREFORMAT_RGBA:\r\n                        return WebGPUConstants.TextureFormat.RGBA16Float;\r\n                    default:\r\n                        return WebGPUConstants.TextureFormat.RGBA16Float;\r\n                }\r\n            case Constants.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:\r\n                // eslint-disable-next-line no-throw-literal\r\n                throw \"TEXTURETYPE_UNSIGNED_SHORT_5_6_5 format not supported in WebGPU\";\r\n            case Constants.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:\r\n                switch (format) {\r\n                    case Constants.TEXTUREFORMAT_RGBA:\r\n                        return WebGPUConstants.TextureFormat.RG11B10UFloat;\r\n                    case Constants.TEXTUREFORMAT_RGBA_INTEGER:\r\n                        // eslint-disable-next-line no-throw-literal\r\n                        throw \"TEXTUREFORMAT_RGBA_INTEGER format not supported in WebGPU when type is TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV\";\r\n                    default:\r\n                        return WebGPUConstants.TextureFormat.RG11B10UFloat;\r\n                }\r\n            case Constants.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:\r\n                switch (format) {\r\n                    case Constants.TEXTUREFORMAT_RGBA:\r\n                        return WebGPUConstants.TextureFormat.RGB9E5UFloat;\r\n                    case Constants.TEXTUREFORMAT_RGBA_INTEGER:\r\n                        // eslint-disable-next-line no-throw-literal\r\n                        throw \"TEXTUREFORMAT_RGBA_INTEGER format not supported in WebGPU when type is TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV\";\r\n                    default:\r\n                        return WebGPUConstants.TextureFormat.RGB9E5UFloat;\r\n                }\r\n            case Constants.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:\r\n                // eslint-disable-next-line no-throw-literal\r\n                throw \"TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4 format not supported in WebGPU\";\r\n            case Constants.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:\r\n                // eslint-disable-next-line no-throw-literal\r\n                throw \"TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1 format not supported in WebGPU\";\r\n            case Constants.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:\r\n                switch (format) {\r\n                    case Constants.TEXTUREFORMAT_RGBA:\r\n                        return WebGPUConstants.TextureFormat.RGB10A2Unorm;\r\n                    case Constants.TEXTUREFORMAT_RGBA_INTEGER:\r\n                        return WebGPUConstants.TextureFormat.RGB10A2UINT;\r\n                    default:\r\n                        return WebGPUConstants.TextureFormat.RGB10A2Unorm;\r\n                }\r\n        }\r\n\r\n        return useSRGBBuffer ? WebGPUConstants.TextureFormat.RGBA8UnormSRGB : WebGPUConstants.TextureFormat.RGBA8Unorm;\r\n    }\r\n\r\n    public static GetNumChannelsFromWebGPUTextureFormat(format: GPUTextureFormat): number {\r\n        switch (format) {\r\n            case WebGPUConstants.TextureFormat.R8Unorm:\r\n            case WebGPUConstants.TextureFormat.R8Snorm:\r\n            case WebGPUConstants.TextureFormat.R8Uint:\r\n            case WebGPUConstants.TextureFormat.R8Sint:\r\n            case WebGPUConstants.TextureFormat.BC4RUnorm:\r\n            case WebGPUConstants.TextureFormat.BC4RSnorm:\r\n            case WebGPUConstants.TextureFormat.R16Uint:\r\n            case WebGPUConstants.TextureFormat.R16Sint:\r\n            case WebGPUConstants.TextureFormat.Depth16Unorm:\r\n            case WebGPUConstants.TextureFormat.R16Float:\r\n            case WebGPUConstants.TextureFormat.R16Unorm:\r\n            case WebGPUConstants.TextureFormat.R16Snorm:\r\n            case WebGPUConstants.TextureFormat.R32Uint:\r\n            case WebGPUConstants.TextureFormat.R32Sint:\r\n            case WebGPUConstants.TextureFormat.R32Float:\r\n            case WebGPUConstants.TextureFormat.Depth32Float:\r\n            case WebGPUConstants.TextureFormat.Stencil8:\r\n            case WebGPUConstants.TextureFormat.Depth24Plus:\r\n            case WebGPUConstants.TextureFormat.EACR11Unorm:\r\n            case WebGPUConstants.TextureFormat.EACR11Snorm:\r\n                return 1;\r\n\r\n            case WebGPUConstants.TextureFormat.RG8Unorm:\r\n            case WebGPUConstants.TextureFormat.RG8Snorm:\r\n            case WebGPUConstants.TextureFormat.RG8Uint:\r\n            case WebGPUConstants.TextureFormat.RG8Sint:\r\n            case WebGPUConstants.TextureFormat.Depth32FloatStencil8:\r\n            case WebGPUConstants.TextureFormat.BC5RGUnorm:\r\n            case WebGPUConstants.TextureFormat.BC5RGSnorm:\r\n            case WebGPUConstants.TextureFormat.RG16Uint:\r\n            case WebGPUConstants.TextureFormat.RG16Sint:\r\n            case WebGPUConstants.TextureFormat.RG16Float:\r\n            case WebGPUConstants.TextureFormat.RG16Unorm:\r\n            case WebGPUConstants.TextureFormat.RG16Snorm:\r\n            case WebGPUConstants.TextureFormat.RG32Uint:\r\n            case WebGPUConstants.TextureFormat.RG32Sint:\r\n            case WebGPUConstants.TextureFormat.RG32Float:\r\n            case WebGPUConstants.TextureFormat.Depth24PlusStencil8:\r\n            case WebGPUConstants.TextureFormat.EACRG11Unorm:\r\n            case WebGPUConstants.TextureFormat.EACRG11Snorm:\r\n                return 2;\r\n\r\n            case WebGPUConstants.TextureFormat.RGB9E5UFloat:\r\n            case WebGPUConstants.TextureFormat.RG11B10UFloat:\r\n            case WebGPUConstants.TextureFormat.BC6HRGBUFloat:\r\n            case WebGPUConstants.TextureFormat.BC6HRGBFloat:\r\n            case WebGPUConstants.TextureFormat.ETC2RGB8Unorm:\r\n            case WebGPUConstants.TextureFormat.ETC2RGB8UnormSRGB:\r\n                return 3;\r\n\r\n            case WebGPUConstants.TextureFormat.RGBA8Unorm:\r\n            case WebGPUConstants.TextureFormat.RGBA8UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.RGBA8Snorm:\r\n            case WebGPUConstants.TextureFormat.RGBA8Uint:\r\n            case WebGPUConstants.TextureFormat.RGBA8Sint:\r\n            case WebGPUConstants.TextureFormat.BGRA8Unorm:\r\n            case WebGPUConstants.TextureFormat.BGRA8UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.RGBA16Unorm:\r\n            case WebGPUConstants.TextureFormat.RGBA16Snorm:\r\n            case WebGPUConstants.TextureFormat.RGB10A2UINT:\r\n            case WebGPUConstants.TextureFormat.RGB10A2Unorm:\r\n            case WebGPUConstants.TextureFormat.BC7RGBAUnorm:\r\n            case WebGPUConstants.TextureFormat.BC7RGBAUnormSRGB:\r\n            case WebGPUConstants.TextureFormat.BC3RGBAUnorm:\r\n            case WebGPUConstants.TextureFormat.BC3RGBAUnormSRGB:\r\n            case WebGPUConstants.TextureFormat.BC2RGBAUnorm:\r\n            case WebGPUConstants.TextureFormat.BC2RGBAUnormSRGB:\r\n            case WebGPUConstants.TextureFormat.BC1RGBAUnorm:\r\n            case WebGPUConstants.TextureFormat.BC1RGBAUnormSRGB:\r\n            case WebGPUConstants.TextureFormat.RGBA16Uint:\r\n            case WebGPUConstants.TextureFormat.RGBA16Sint:\r\n            case WebGPUConstants.TextureFormat.RGBA16Float:\r\n            case WebGPUConstants.TextureFormat.RGBA32Uint:\r\n            case WebGPUConstants.TextureFormat.RGBA32Sint:\r\n            case WebGPUConstants.TextureFormat.RGBA32Float:\r\n            case WebGPUConstants.TextureFormat.ETC2RGB8A1Unorm:\r\n            case WebGPUConstants.TextureFormat.ETC2RGB8A1UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ETC2RGBA8Unorm:\r\n            case WebGPUConstants.TextureFormat.ETC2RGBA8UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ASTC4x4Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC4x4UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ASTC5x4Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC5x4UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ASTC5x5Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC5x5UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ASTC6x5Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC6x5UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ASTC6x6Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC6x6UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ASTC8x5Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC8x5UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ASTC8x6Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC8x6UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ASTC8x8Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC8x8UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ASTC10x5Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC10x5UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ASTC10x6Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC10x6UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ASTC10x8Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC10x8UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ASTC10x10Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC10x10UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ASTC12x10Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC12x10UnormSRGB:\r\n            case WebGPUConstants.TextureFormat.ASTC12x12Unorm:\r\n            case WebGPUConstants.TextureFormat.ASTC12x12UnormSRGB:\r\n                return 4;\r\n        }\r\n\r\n        // eslint-disable-next-line no-throw-literal\r\n        throw `Unknown format ${format}!`;\r\n    }\r\n\r\n    public static HasStencilAspect(format: GPUTextureFormat): boolean {\r\n        switch (format) {\r\n            case WebGPUConstants.TextureFormat.Stencil8:\r\n            case WebGPUConstants.TextureFormat.Depth32FloatStencil8:\r\n            case WebGPUConstants.TextureFormat.Depth24PlusStencil8:\r\n                return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    public static HasDepthAspect(format: GPUTextureFormat): boolean {\r\n        switch (format) {\r\n            case WebGPUConstants.TextureFormat.Depth16Unorm:\r\n            case WebGPUConstants.TextureFormat.Depth24Plus:\r\n            case WebGPUConstants.TextureFormat.Depth24PlusStencil8:\r\n            case WebGPUConstants.TextureFormat.Depth32Float:\r\n            case WebGPUConstants.TextureFormat.Depth32FloatStencil8:\r\n                return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    public static HasDepthAndStencilAspects(format: GPUTextureFormat): boolean {\r\n        switch (format) {\r\n            case WebGPUConstants.TextureFormat.Depth32FloatStencil8:\r\n            case WebGPUConstants.TextureFormat.Depth24PlusStencil8:\r\n                return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    public static GetDepthFormatOnly(format: GPUTextureFormat): GPUTextureFormat {\r\n        switch (format) {\r\n            case WebGPUConstants.TextureFormat.Depth16Unorm:\r\n                return WebGPUConstants.TextureFormat.Depth16Unorm;\r\n            case WebGPUConstants.TextureFormat.Depth24Plus:\r\n                return WebGPUConstants.TextureFormat.Depth24Plus;\r\n            case WebGPUConstants.TextureFormat.Depth24PlusStencil8:\r\n                return WebGPUConstants.TextureFormat.Depth24Plus;\r\n            case WebGPUConstants.TextureFormat.Depth32Float:\r\n                return WebGPUConstants.TextureFormat.Depth32Float;\r\n            case WebGPUConstants.TextureFormat.Depth32FloatStencil8:\r\n                return WebGPUConstants.TextureFormat.Depth32Float;\r\n        }\r\n\r\n        return format;\r\n    }\r\n\r\n    public static GetSample(sampleCount: number) {\r\n        // WebGPU only supports 1 or 4\r\n        return sampleCount > 1 ? 4 : 1;\r\n    }\r\n}\r\n", "import type { InternalTexture } from \"core/Materials/Textures/internalTexture\";\r\nimport { InternalTextureSource } from \"core/Materials/Textures/internalTexture\";\r\nimport { AbstractEngine } from \"./abstractEngine\";\r\nimport type { WebGPUCacheRenderPipeline } from \"./WebGPU/webgpuCacheRenderPipeline\";\r\nimport type { WebGPUTextureManager } from \"./WebGPU/webgpuTextureManager\";\r\nimport type { WebGPUHardwareTexture } from \"./WebGPU/webgpuHardwareTexture\";\r\nimport type { Nullable } from \"core/types\";\r\nimport { Logger } from \"core/Misc/logger\";\r\nimport { WebGPUTextureHelper } from \"./WebGPU/webgpuTextureHelper\";\r\nimport type { WebGPURenderTargetWrapper } from \"./WebGPU/webgpuRenderTargetWrapper\";\r\nimport { WebGPUPerfCounter } from \"./WebGPU/webgpuPerfCounter\";\r\nimport type { WebGPUSnapshotRendering } from \"./WebGPU/webgpuSnapshotRendering\";\r\nimport { Constants } from \"./constants\";\r\nimport type { WebGPUBundleList } from \"./WebGPU/webgpuBundleList\";\r\nimport type { WebGPUTimestampQuery } from \"./WebGPU/webgpuTimestampQuery\";\r\nimport type { WebGPUOcclusionQuery } from \"./WebGPU/webgpuOcclusionQuery\";\r\n\r\n/**\r\n * The base engine class for WebGPU\r\n */\r\nexport abstract class ThinWebGPUEngine extends AbstractEngine {\r\n    // TODO WEBGPU remove those variables when code stabilized\r\n    /** @internal */\r\n    public dbgShowShaderCode = false;\r\n    /** @internal */\r\n    public dbgSanityChecks = true;\r\n    /** @internal */\r\n    public dbgVerboseLogsNumFrames = 10;\r\n    /** @internal */\r\n    public dbgLogIfNotDrawWrapper = true;\r\n    /** @internal */\r\n    public dbgShowEmptyEnableEffectCalls = true;\r\n    /** @internal */\r\n    public dbgVerboseLogsForFirstFrames = false;\r\n\r\n    /** @internal */\r\n    public _textureHelper: WebGPUTextureManager;\r\n    /** @internal */\r\n    public _cacheRenderPipeline: WebGPUCacheRenderPipeline;\r\n    /** @internal */\r\n    public _occlusionQuery: WebGPUOcclusionQuery;\r\n\r\n    // Frame Life Cycle (recreated each frame)\r\n    /** @internal */\r\n    public _renderEncoder: GPUCommandEncoder;\r\n    /** @internal */\r\n    public _uploadEncoder: GPUCommandEncoder;\r\n\r\n    /** @internal */\r\n    public _currentRenderPass: Nullable<GPURenderPassEncoder> = null;\r\n\r\n    protected _snapshotRendering: WebGPUSnapshotRendering;\r\n    protected _snapshotRenderingMode = Constants.SNAPSHOTRENDERING_STANDARD;\r\n\r\n    /** @internal */\r\n    public _timestampQuery: WebGPUTimestampQuery;\r\n    /** @internal */\r\n    public _timestampIndex = 0;\r\n\r\n    /**\r\n     * Gets the GPU time spent in the main render pass for the last frame rendered (in nanoseconds).\r\n     * You have to enable the \"timestamp-query\" extension in the engine constructor options and set engine.enableGPUTimingMeasurements = true.\r\n     * It will only return time spent in the main pass, not additional render target / compute passes (if any)!\r\n     */\r\n    public readonly gpuTimeInFrameForMainPass?: WebGPUPerfCounter;\r\n\r\n    /**\r\n     * Used for both the compatibilityMode=false and the snapshot rendering modes (as both can't be enabled at the same time)\r\n     * @internal\r\n     */\r\n    public _bundleList: WebGPUBundleList;\r\n\r\n    /**\r\n     * Enables or disables GPU timing measurements.\r\n     * Note that this is only supported if the \"timestamp-query\" extension is enabled in the options.\r\n     */\r\n    public get enableGPUTimingMeasurements(): boolean {\r\n        return this._timestampQuery.enable;\r\n    }\r\n\r\n    public set enableGPUTimingMeasurements(enable: boolean) {\r\n        if (this._timestampQuery.enable === enable) {\r\n            return;\r\n        }\r\n        (this.gpuTimeInFrameForMainPass as any) = enable ? new WebGPUPerfCounter() : undefined;\r\n        this._timestampQuery.enable = enable;\r\n    }\r\n\r\n    protected _currentPassIsMainPass() {\r\n        return this._currentRenderTarget === null;\r\n    }\r\n\r\n    /** @internal */\r\n    public _endCurrentRenderPass(): number {\r\n        if (!this._currentRenderPass) {\r\n            return 0;\r\n        }\r\n\r\n        const currentPassIndex = this._currentPassIsMainPass() ? 2 : 1;\r\n\r\n        if (!this._snapshotRendering.endRenderPass(this._currentRenderPass) && !this.compatibilityMode) {\r\n            this._bundleList.run(this._currentRenderPass);\r\n            this._bundleList.reset();\r\n        }\r\n        this._currentRenderPass.end();\r\n\r\n        this._timestampQuery.endPass(\r\n            this._timestampIndex,\r\n            (this._currentRenderTarget && (this._currentRenderTarget as WebGPURenderTargetWrapper).gpuTimeInFrame\r\n                ? (this._currentRenderTarget as WebGPURenderTargetWrapper).gpuTimeInFrame\r\n                : this.gpuTimeInFrameForMainPass) as WebGPUPerfCounter\r\n        );\r\n        this._timestampIndex += 2;\r\n\r\n        if (this.dbgVerboseLogsForFirstFrames) {\r\n            if ((this as any)._count === undefined) {\r\n                (this as any)._count = 0;\r\n            }\r\n            if (!(this as any)._count || (this as any)._count < this.dbgVerboseLogsNumFrames) {\r\n                Logger.Log(\r\n                    \"frame #\" +\r\n                        (this as any)._count +\r\n                        \" - \" +\r\n                        (currentPassIndex === 2 ? \"main\" : \"render target\") +\r\n                        \" end pass\" +\r\n                        (currentPassIndex === 1 ? \" - internalTexture.uniqueId=\" + this._currentRenderTarget?.texture?.uniqueId : \"\")\r\n                );\r\n            }\r\n        }\r\n        this._currentRenderPass = null;\r\n\r\n        return currentPassIndex;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _generateMipmaps(texture: InternalTexture, commandEncoder?: GPUCommandEncoder) {\r\n        commandEncoder = commandEncoder ?? this._renderEncoder;\r\n\r\n        const gpuHardwareTexture = texture._hardwareTexture as Nullable<WebGPUHardwareTexture>;\r\n\r\n        if (!gpuHardwareTexture) {\r\n            return;\r\n        }\r\n\r\n        if (commandEncoder === this._renderEncoder) {\r\n            // We must close the current pass (if any) because we are going to use the render encoder to generate the mipmaps (so, we are going to create a new render pass)\r\n            this._endCurrentRenderPass();\r\n        }\r\n\r\n        const mipmapCount = WebGPUTextureHelper.ComputeNumMipmapLevels(texture.width, texture.height);\r\n\r\n        if (this.dbgVerboseLogsForFirstFrames) {\r\n            if ((this as any)._count === undefined) {\r\n                (this as any)._count = 0;\r\n            }\r\n            if (!(this as any)._count || (this as any)._count < this.dbgVerboseLogsNumFrames) {\r\n                Logger.Log(\r\n                    \"frame #\" +\r\n                        (this as any)._count +\r\n                        \" - generate mipmaps - width=\" +\r\n                        texture.width +\r\n                        \", height=\" +\r\n                        texture.height +\r\n                        \", isCube=\" +\r\n                        texture.isCube +\r\n                        \", command encoder=\" +\r\n                        (commandEncoder === this._renderEncoder ? \"render\" : \"copy\")\r\n                );\r\n            }\r\n        }\r\n\r\n        if (texture.isCube) {\r\n            this._textureHelper.generateCubeMipmaps(gpuHardwareTexture, mipmapCount, commandEncoder);\r\n        } else if (texture._source === InternalTextureSource.Raw || texture._source === InternalTextureSource.Raw2DArray) {\r\n            this._textureHelper.generateMipmaps(gpuHardwareTexture, texture.mipLevelCount, 0, commandEncoder);\r\n        } else {\r\n            this._textureHelper.generateMipmaps(gpuHardwareTexture, mipmapCount, 0, commandEncoder);\r\n        }\r\n    }\r\n}\r\n", "import type { Nullable } from \"../../types\";\r\nimport { WebGPUTextureHelper } from \"./webgpuTextureHelper\";\r\n\r\n/** @internal */\r\ninterface IWebGPURenderItem {\r\n    run(renderPass: GPURenderPassEncoder): void;\r\n    clone(): IWebGPURenderItem;\r\n}\r\n\r\n/** @internal */\r\nexport class WebGPURenderItemViewport implements IWebGPURenderItem {\r\n    public x: number;\r\n    public y: number;\r\n    public w: number;\r\n    public h: number;\r\n\r\n    public constructor(x: number, y: number, w: number, h: number) {\r\n        this.x = Math.floor(x);\r\n        this.y = Math.floor(y);\r\n        this.w = Math.floor(w);\r\n        this.h = Math.floor(h);\r\n    }\r\n\r\n    public run(renderPass: GPURenderPassEncoder) {\r\n        renderPass.setViewport(this.x, this.y, this.w, this.h, 0, 1);\r\n    }\r\n\r\n    public clone(): WebGPURenderItemViewport {\r\n        return new WebGPURenderItemViewport(this.x, this.y, this.w, this.h);\r\n    }\r\n}\r\n\r\n/** @internal */\r\nexport class WebGPURenderItemScissor implements IWebGPURenderItem {\r\n    public constructor(\r\n        public x: number,\r\n        public y: number,\r\n        public w: number,\r\n        public h: number\r\n    ) {}\r\n\r\n    public run(renderPass: GPURenderPassEncoder) {\r\n        renderPass.setScissorRect(this.x, this.y, this.w, this.h);\r\n    }\r\n\r\n    public clone(): WebGPURenderItemScissor {\r\n        return new WebGPURenderItemScissor(this.x, this.y, this.w, this.h);\r\n    }\r\n}\r\n\r\n/** @internal */\r\nexport class WebGPURenderItemStencilRef implements IWebGPURenderItem {\r\n    public constructor(public ref: number) {}\r\n\r\n    public run(renderPass: GPURenderPassEncoder) {\r\n        renderPass.setStencilReference(this.ref);\r\n    }\r\n\r\n    public clone(): WebGPURenderItemStencilRef {\r\n        return new WebGPURenderItemStencilRef(this.ref);\r\n    }\r\n}\r\n\r\n/** @internal */\r\nexport class WebGPURenderItemBlendColor implements IWebGPURenderItem {\r\n    public constructor(public color: Nullable<number>[]) {}\r\n\r\n    public run(renderPass: GPURenderPassEncoder) {\r\n        renderPass.setBlendConstant(this.color as GPUColor);\r\n    }\r\n\r\n    public clone(): WebGPURenderItemBlendColor {\r\n        return new WebGPURenderItemBlendColor(this.color);\r\n    }\r\n}\r\n\r\n/** @internal */\r\nexport class WebGPURenderItemBeginOcclusionQuery implements IWebGPURenderItem {\r\n    public constructor(public query: number) {}\r\n\r\n    public run(renderPass: GPURenderPassEncoder) {\r\n        renderPass.beginOcclusionQuery(this.query);\r\n    }\r\n\r\n    public clone(): WebGPURenderItemBeginOcclusionQuery {\r\n        return new WebGPURenderItemBeginOcclusionQuery(this.query);\r\n    }\r\n}\r\n\r\n/** @internal */\r\nexport class WebGPURenderItemEndOcclusionQuery implements IWebGPURenderItem {\r\n    public constructor() {}\r\n\r\n    public run(renderPass: GPURenderPassEncoder) {\r\n        renderPass.endOcclusionQuery();\r\n    }\r\n\r\n    public clone(): WebGPURenderItemEndOcclusionQuery {\r\n        return new WebGPURenderItemEndOcclusionQuery();\r\n    }\r\n}\r\n\r\nclass WebGPURenderItemBundles implements IWebGPURenderItem {\r\n    public bundles: GPURenderBundle[];\r\n\r\n    public constructor() {\r\n        this.bundles = [];\r\n    }\r\n\r\n    public run(renderPass: GPURenderPassEncoder) {\r\n        renderPass.executeBundles(this.bundles);\r\n    }\r\n\r\n    public clone(): WebGPURenderItemBundles {\r\n        const cloned = new WebGPURenderItemBundles();\r\n        cloned.bundles = this.bundles;\r\n        return cloned;\r\n    }\r\n}\r\n\r\n/** @internal */\r\nexport class WebGPUBundleList {\r\n    private _device: GPUDevice;\r\n    private _bundleEncoder: GPURenderBundleEncoder | undefined;\r\n\r\n    private _list: IWebGPURenderItem[];\r\n    private _listLength: number;\r\n\r\n    private _currentItemIsBundle: boolean;\r\n    private _currentBundleList: GPURenderBundle[];\r\n\r\n    public numDrawCalls = 0;\r\n\r\n    public constructor(device: GPUDevice) {\r\n        this._device = device;\r\n        this._list = new Array(10);\r\n        this._listLength = 0;\r\n    }\r\n\r\n    public addBundle(bundle?: GPURenderBundle): void {\r\n        if (!this._currentItemIsBundle) {\r\n            const item = new WebGPURenderItemBundles();\r\n\r\n            this._list[this._listLength++] = item;\r\n            this._currentBundleList = item.bundles;\r\n            this._currentItemIsBundle = true;\r\n        }\r\n        if (bundle) {\r\n            this._currentBundleList.push(bundle);\r\n        }\r\n    }\r\n\r\n    private _finishBundle(): void {\r\n        if (this._currentItemIsBundle && this._bundleEncoder) {\r\n            this._currentBundleList.push(this._bundleEncoder.finish());\r\n            this._bundleEncoder = undefined;\r\n            this._currentItemIsBundle = false;\r\n        }\r\n    }\r\n\r\n    public addItem(item: IWebGPURenderItem) {\r\n        this._finishBundle();\r\n        this._list[this._listLength++] = item;\r\n        this._currentItemIsBundle = false;\r\n    }\r\n\r\n    public getBundleEncoder(colorFormats: (GPUTextureFormat | null)[], depthStencilFormat: GPUTextureFormat | undefined, sampleCount: number): GPURenderBundleEncoder {\r\n        if (!this._currentItemIsBundle) {\r\n            this.addBundle();\r\n            this._bundleEncoder = this._device.createRenderBundleEncoder({\r\n                colorFormats,\r\n                depthStencilFormat,\r\n                sampleCount: WebGPUTextureHelper.GetSample(sampleCount),\r\n            });\r\n        }\r\n        return this._bundleEncoder!;\r\n    }\r\n\r\n    public close(): void {\r\n        this._finishBundle();\r\n    }\r\n\r\n    public run(renderPass: GPURenderPassEncoder) {\r\n        this.close();\r\n        for (let i = 0; i < this._listLength; ++i) {\r\n            this._list[i].run(renderPass);\r\n        }\r\n    }\r\n\r\n    public reset() {\r\n        this._listLength = 0;\r\n        this._currentItemIsBundle = false;\r\n        this.numDrawCalls = 0;\r\n    }\r\n\r\n    public clone(): WebGPUBundleList {\r\n        this.close();\r\n\r\n        const cloned = new WebGPUBundleList(this._device);\r\n\r\n        cloned._list = new Array(this._listLength);\r\n        cloned._listLength = this._listLength;\r\n        cloned.numDrawCalls = this.numDrawCalls;\r\n\r\n        for (let i = 0; i < this._listLength; ++i) {\r\n            cloned._list[i] = this._list[i].clone();\r\n        }\r\n\r\n        return cloned;\r\n    }\r\n}\r\n", "import { ThinWebGPUEngine } from \"core/Engines/thinWebGPUEngine\";\r\nimport { WebGPURenderItemBeginOcclusionQuery, WebGPURenderItemEndOcclusionQuery } from \"../webgpuBundleList\";\r\n\r\nimport type { PerfCounter } from \"../../../Misc/perfCounter\";\r\nimport type { OcclusionQuery } from \"../../../Engines/AbstractEngine/abstractEngine.query\";\r\n\r\nimport \"../../../Engines/AbstractEngine/abstractEngine.query\";\r\n\r\nThinWebGPUEngine.prototype.getGPUFrameTimeCounter = function (): PerfCounter {\r\n    return this._timestampQuery.gpuFrameTimeCounter;\r\n};\r\n\r\nThinWebGPUEngine.prototype.captureGPUFrameTime = function (value: boolean) {\r\n    this._timestampQuery.enable = value && !!this._caps.timerQuery;\r\n};\r\n\r\nThinWebGPUEngine.prototype.createQuery = function (): OcclusionQuery {\r\n    return this._occlusionQuery.createQuery();\r\n};\r\n\r\nThinWebGPUEngine.prototype.deleteQuery = function (query: OcclusionQuery): ThinWebGPUEngine {\r\n    this._occlusionQuery.deleteQuery(query as number);\r\n\r\n    return this;\r\n};\r\n\r\nThinWebGPUEngine.prototype.isQueryResultAvailable = function (query: OcclusionQuery): boolean {\r\n    return this._occlusionQuery.isQueryResultAvailable(query as number);\r\n};\r\n\r\nThinWebGPUEngine.prototype.getQueryResult = function (query: OcclusionQuery): number {\r\n    return this._occlusionQuery.getQueryResult(query as number);\r\n};\r\n\r\nThinWebGPUEngine.prototype.beginOcclusionQuery = function (algorithmType: number, query: OcclusionQuery): boolean {\r\n    if (this.compatibilityMode) {\r\n        if (this._occlusionQuery.canBeginQuery(query as number)) {\r\n            this._currentRenderPass?.beginOcclusionQuery(query as number);\r\n            return true;\r\n        }\r\n    } else {\r\n        this._bundleList.addItem(new WebGPURenderItemBeginOcclusionQuery(query as number));\r\n        return true;\r\n    }\r\n\r\n    return false;\r\n};\r\n\r\nThinWebGPUEngine.prototype.endOcclusionQuery = function (): ThinWebGPUEngine {\r\n    if (this.compatibilityMode) {\r\n        this._currentRenderPass?.endOcclusionQuery();\r\n    } else {\r\n        this._bundleList.addItem(new WebGPURenderItemEndOcclusionQuery());\r\n    }\r\n    return this;\r\n};\r\n"],
  "mappings": "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",
  "names": ["init_buffer"]
}
