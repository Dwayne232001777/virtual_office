import {
  SceneSerializer,
  init_sceneSerializer
} from "./chunk-YERFS6AN.js";
import {
  Logger,
  init_logger
} from "./chunk-2X44KPCK.js";
import {
  __esm
} from "./chunk-V4OQ3NZ2.js";

// node_modules/@babylonjs/core/Misc/reflector.js
var Reflector;
var init_reflector = __esm({
  "node_modules/@babylonjs/core/Misc/reflector.js"() {
    init_logger();
    init_sceneSerializer();
    Reflector = class _Reflector {
      /**
       * Constructs a reflector object.
       * @param scene The scene to use
       * @param hostname The hostname of the reflector bridge
       * @param port The port of the reflector bridge
       */
      constructor(scene, hostname, port) {
        this._scene = scene;
        Logger.Log(`[Reflector] Connecting to ws://${hostname}:${port}`);
        this._webSocket = new WebSocket(`ws://${hostname}:${port}`);
        this._webSocket.onmessage = (event) => {
          const message = event.data;
          if (message.startsWith(_Reflector._SERVER_PREFIX)) {
            const serverMessage = message.substring(_Reflector._SERVER_PREFIX.length);
            Logger.Log(`[Reflector] Received server message: ${serverMessage.substring(0, 64)}`);
            this._handleServerMessage(serverMessage);
            return;
          } else {
            Logger.Log(`[Reflector] Received client message: ${message.substring(0, 64)}`);
            this._handleClientMessage();
          }
        };
        this._webSocket.onclose = (event) => {
          Logger.Log(`[Reflector] Disconnected ${event.code} ${event.reason}`);
        };
      }
      /**
       * Closes the reflector connection
       */
      close() {
        this._webSocket.close();
      }
      _handleServerMessage(message) {
        switch (message) {
          case "connected": {
            SceneSerializer.SerializeAsync(this._scene).then((serialized) => {
              this._webSocket.send(`load|${JSON.stringify(serialized)}`);
            });
            break;
          }
        }
      }
      _handleClientMessage() {
      }
    };
    Reflector._SERVER_PREFIX = "$$";
  }
});

export {
  Reflector,
  init_reflector
};
//# sourceMappingURL=chunk-DVDBHFKN.js.map
